!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=16)}([function(e,t){var n={};n.EPSILON=1e-6,n.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,n.RANDOM=Math.random,n.ENABLE_SIMD=!1,n.SIMD_AVAILABLE=n.ARRAY_TYPE===Float32Array&&"SIMD"in this,n.USE_SIMD=n.ENABLE_SIMD&&n.SIMD_AVAILABLE,n.setMatrixArrayType=function(e){n.ARRAY_TYPE=e};var r=Math.PI/180;n.toRadian=function(e){return e*r},n.equals=function(e,t){return Math.abs(e-t)<=n.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},e.exports=n},function(e,t,n){e.exports={create:n(21),clone:n(19),copy:n(20),identity:n(4),transpose:n(39),invert:n(26),adjoint:n(18),determinant:n(22),multiply:n(28),translate:n(38),scale:n(36),rotate:n(32),rotateX:n(33),rotateY:n(34),rotateZ:n(35),fromRotationTranslation:n(24),fromQuat:n(23),frustum:n(25),perspective:n(30),perspectiveFromFieldOfView:n(31),ortho:n(29),lookAt:n(27),str:n(37)}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function a(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,a,u,s,f;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],i(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),n.apply(this,u)}else if(o(n))for(u=Array.prototype.slice.call(arguments,1),f=n.slice(),a=f.length,s=0;s<a;s++)f[s].apply(this,u);return!0},n.prototype.addListener=function(e,t){var a;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(a=i(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),a||(a=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var a=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,a,i,u;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,a=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(u=i;u-- >0;)if(n[u]===t||n[u].listener&&n[u].listener===t){a=u;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.viewportWidth,n=e.viewportHeight;return a.default.perspective([],Math.PI/2,t/n,.01,1e3)};var r=n(1),a=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t){function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.exports=n},function(e,t,n){var r=n(0),a={};a.create=function(){var e=new r.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},a.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},a.clone=function(e){var t=new r.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},a.fromValues=function(e,t,n,a,o,i,u,s,f){var l=new r.ARRAY_TYPE(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=a,l[4]=o,l[5]=i,l[6]=u,l[7]=s,l[8]=f,l},a.set=function(e,t,n,r,a,o,i,u,s,f){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=o,e[5]=i,e[6]=u,e[7]=s,e[8]=f,e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},a.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},a.invert=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],f=t[7],l=t[8],c=l*i-u*f,d=-l*o+u*s,m=f*o-i*s,h=n*c+r*d+a*m;return h?(h=1/h,e[0]=c*h,e[1]=(-l*r+a*f)*h,e[2]=(u*r-a*i)*h,e[3]=d*h,e[4]=(l*n-a*s)*h,e[5]=(-u*n+a*o)*h,e[6]=m*h,e[7]=(-f*n+r*s)*h,e[8]=(i*n-r*o)*h,e):null},a.adjoint=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],f=t[7],l=t[8];return e[0]=i*l-u*f,e[1]=a*f-r*l,e[2]=r*u-a*i,e[3]=u*s-o*l,e[4]=n*l-a*s,e[5]=a*o-n*u,e[6]=o*f-i*s,e[7]=r*s-n*f,e[8]=n*i-r*o,e},a.determinant=function(e){var t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],i=e[5],u=e[6],s=e[7],f=e[8];return t*(f*o-i*s)+n*(-f*a+i*u)+r*(s*a-o*u)},a.multiply=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=t[6],l=t[7],c=t[8],d=n[0],m=n[1],h=n[2],p=n[3],b=n[4],v=n[5],x=n[6],g=n[7],y=n[8];return e[0]=d*r+m*i+h*f,e[1]=d*a+m*u+h*l,e[2]=d*o+m*s+h*c,e[3]=p*r+b*i+v*f,e[4]=p*a+b*u+v*l,e[5]=p*o+b*s+v*c,e[6]=x*r+g*i+y*f,e[7]=x*a+g*u+y*l,e[8]=x*o+g*s+y*c,e},a.mul=a.multiply,a.translate=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=t[6],l=t[7],c=t[8],d=n[0],m=n[1];return e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=u,e[5]=s,e[6]=d*r+m*i+f,e[7]=d*a+m*u+l,e[8]=d*o+m*s+c,e},a.rotate=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=t[6],l=t[7],c=t[8],d=Math.sin(n),m=Math.cos(n);return e[0]=m*r+d*i,e[1]=m*a+d*u,e[2]=m*o+d*s,e[3]=m*i-d*r,e[4]=m*u-d*a,e[5]=m*s-d*o,e[6]=f,e[7]=l,e[8]=c,e},a.scale=function(e,t,n){var r=n[0],a=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},a.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},a.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},a.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},a.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},a.fromQuat=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n+n,u=r+r,s=a+a,f=n*i,l=r*i,c=r*u,d=a*i,m=a*u,h=a*s,p=o*i,b=o*u,v=o*s;return e[0]=1-c-h,e[3]=l-v,e[6]=d+b,e[1]=l+v,e[4]=1-f-h,e[7]=m-p,e[2]=d-b,e[5]=m+p,e[8]=1-f-c,e},a.normalFromMat4=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],f=t[7],l=t[8],c=t[9],d=t[10],m=t[11],h=t[12],p=t[13],b=t[14],v=t[15],x=n*u-r*i,g=n*s-a*i,y=n*f-o*i,M=r*s-a*u,S=r*f-o*u,w=a*f-o*s,D=l*p-c*h,I=l*b-d*h,F=l*v-m*h,A=c*b-d*p,_=c*v-m*p,E=d*v-m*b,k=x*E-g*_+y*A+M*F-S*I+w*D;return k?(k=1/k,e[0]=(u*E-s*_+f*A)*k,e[1]=(s*F-i*E-f*I)*k,e[2]=(i*_-u*F+f*D)*k,e[3]=(a*_-r*E-o*A)*k,e[4]=(n*E-a*F+o*I)*k,e[5]=(r*F-n*_-o*D)*k,e[6]=(p*w-b*S+v*M)*k,e[7]=(b*y-h*w-v*g)*k,e[8]=(h*S-p*y+v*x)*k,e):null},a.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},a.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e},a.sub=a.subtract,a.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},a.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e},a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},a.equals=function(e,t){var n=e[0],a=e[1],o=e[2],i=e[3],u=e[4],s=e[5],f=e[6],l=e[7],c=e[8],d=t[0],m=t[1],h=t[2],p=t[3],b=t[4],v=t[5],x=e[6],g=t[7],y=t[8];return Math.abs(n-d)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-m)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-h)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(i-p)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(u-b)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(s-v)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(f-x)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(x))&&Math.abs(l-g)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))},e.exports=a},function(e,t,n){var r=n(0),a={};a.create=function(){var e=new r.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e},a.clone=function(e){var t=new r.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},a.fromValues=function(e,t,n){var a=new r.ARRAY_TYPE(3);return a[0]=e,a[1]=t,a[2]=n,a},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},a.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},a.div=a.divide,a.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},a.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},a.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},a.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.sqrt(n*n+r*r+a*a)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},a.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},a.normalize=function(e,t){var n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},a.cross=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[0],u=n[1],s=n[2];return e[0]=a*s-o*u,e[1]=o*i-r*s,e[2]=r*u-a*i,e},a.lerp=function(e,t,n,r){var a=t[0],o=t[1],i=t[2];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e},a.hermite=function(e,t,n,r,a,o){var i=o*o,u=i*(2*o-3)+1,s=i*(o-2)+o,f=i*(o-1),l=i*(3-2*o);return e[0]=t[0]*u+n[0]*s+r[0]*f+a[0]*l,e[1]=t[1]*u+n[1]*s+r[1]*f+a[1]*l,e[2]=t[2]*u+n[2]*s+r[2]*f+a[2]*l,e},a.bezier=function(e,t,n,r,a,o){var i=1-o,u=i*i,s=o*o,f=u*i,l=3*o*u,c=3*s*i,d=s*o;return e[0]=t[0]*f+n[0]*l+r[0]*c+a[0]*d,e[1]=t[1]*f+n[1]*l+r[1]*c+a[1]*d,e[2]=t[2]*f+n[2]*l+r[2]*c+a[2]*d,e},a.random=function(e,t){t=t||1;var n=2*r.RANDOM()*Math.PI,a=2*r.RANDOM()-1,o=Math.sqrt(1-a*a)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=a*t,e},a.transformMat4=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,e[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,e[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,e},a.transformMat3=function(e,t,n){var r=t[0],a=t[1],o=t[2];return e[0]=r*n[0]+a*n[3]+o*n[6],e[1]=r*n[1]+a*n[4]+o*n[7],e[2]=r*n[2]+a*n[5]+o*n[8],e},a.transformQuat=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[0],u=n[1],s=n[2],f=n[3],l=f*r+u*o-s*a,c=f*a+s*r-i*o,d=f*o+i*a-u*r,m=-i*r-u*a-s*o;return e[0]=l*f+m*-i+c*-s-d*-u,e[1]=c*f+m*-u+d*-i-l*-s,e[2]=d*f+m*-s+l*-u-c*-i,e},a.rotateX=function(e,t,n,r){var a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0],o[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),o[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},a.rotateY=function(e,t,n,r){var a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),o[1]=a[1],o[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},a.rotateZ=function(e,t,n,r){var a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),o[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),o[2]=a[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},a.forEach=function(){var e=a.create();return function(t,n,r,a,o,i){var u,s;for(n||(n=3),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],o(e,e,i),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),a.angle=function(e,t){var n=a.fromValues(e[0],e[1],e[2]),r=a.fromValues(t[0],t[1],t[2]);a.normalize(n,n),a.normalize(r,r);var o=a.dot(n,r);return o>1?0:Math.acos(o)},a.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},a.equals=function(e,t){var n=e[0],a=e[1],o=e[2],i=t[0],u=t[1],s=t[2];return Math.abs(n-i)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(a-u)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-s)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))},e.exports=a},function(e,t,n){var r=n(0),a={};a.create=function(){var e=new r.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},a.clone=function(e){var t=new r.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.fromValues=function(e,t,n,a){var o=new r.ARRAY_TYPE(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=a,o},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.set=function(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},a.div=a.divide,a.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},a.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},a.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},a.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(n*n+r*r+a*a+o*o)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+a*a+o*o},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1],r=e[2],a=e[3];return Math.sqrt(t*t+n*n+r*r+a*a)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},a.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},a.normalize=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i),e[0]=n*i,e[1]=r*i,e[2]=a*i,e[3]=o*i),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},a.lerp=function(e,t,n,r){var a=t[0],o=t[1],i=t[2],u=t[3];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e[3]=u+r*(n[3]-u),e},a.random=function(e,t){return t=t||1,e[0]=r.RANDOM(),e[1]=r.RANDOM(),e[2]=r.RANDOM(),e[3]=r.RANDOM(),a.normalize(e,e),a.scale(e,e,t),e},a.transformMat4=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3];return e[0]=n[0]*r+n[4]*a+n[8]*o+n[12]*i,e[1]=n[1]*r+n[5]*a+n[9]*o+n[13]*i,e[2]=n[2]*r+n[6]*a+n[10]*o+n[14]*i,e[3]=n[3]*r+n[7]*a+n[11]*o+n[15]*i,e},a.transformQuat=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[0],u=n[1],s=n[2],f=n[3],l=f*r+u*o-s*a,c=f*a+s*r-i*o,d=f*o+i*a-u*r,m=-i*r-u*a-s*o;return e[0]=l*f+m*-i+c*-s-d*-u,e[1]=c*f+m*-u+d*-i-l*-s,e[2]=d*f+m*-s+l*-u-c*-i,e[3]=t[3],e},a.forEach=function(){var e=a.create();return function(t,n,r,a,o,i){var u,s;for(n||(n=4),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],o(e,e,i),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),a.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},a.equals=function(e,t){var n=e[0],a=e[1],o=e[2],i=e[3],u=t[0],s=t[1],f=t[2],l=t[3];return Math.abs(n-u)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-s)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(o-f)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(i-l)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))},e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[[0,2,1],[2,3,1],[4,6,5],[6,7,5],[4,5,1],[5,0,1],[7,6,2],[6,3,2],[5,7,0],[7,2,0],[1,3,4],[3,6,4]];t.default={positions:[[.5,.5,.5],[.5,.5,-.5],[.5,-.5,.5],[.5,-.5,-.5],[-.5,.5,-.5],[-.5,.5,.5],[-.5,-.5,-.5],[-.5,-.5,.5]],faces:[].concat(r)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(t,n,r){return e({frag:s.default,vert:l.default,attributes:{position:n.positions},uniforms:{proj:o.default,model:t.model,view:t.view},elements:r,frontFace:"ccw",framebuffer:t.fbo,cull:{face:"front",enable:!0}})}};var a=n(3),o=r(a),i=n(1),u=(r(i),n(53)),s=r(u),f=n(54),l=r(f)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=new Image;return new Promise(function(n){t.onload=function(){return n(t)},t.src=e})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(t,n,r){return e({frag:s.default,vert:l.default,attributes:{position:n.positions},uniforms:{proj:o.default,model:t.model,view:t.view,cubeTex:t.cubeTexture,transferTex:t.transferTex,tex:t.fbo,steps:256,alphaCorrection:.1},elements:r,cull:{face:"back",enable:!0},frontFace:"ccw",framebuffer:null})}};var a=n(3),o=r(a),i=n(1),u=(r(i),n(55)),s=r(u),f=n(56),l=r(f)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=document.createElement("canvas");e.width=256,e.height=20,e.style.width="256px",e.style.height="20px",e.style.position="fixed";var t=e.getContext("2d"),n=t.createLinearGradient(0,0,e.width-1,e.height-1);return n.addColorStop(.1,"#ffffff"),n.addColorStop(.5,"#ff9900"),n.addColorStop(1,"#ff0000"),t.fillStyle=n,t.fillRect(0,0,e.width,e.height),document.querySelector(".transfer-function").appendChild(e),t}},function(e,t,n){function r(e,t,n){function r(){var t=r.parent||e.parentNode;if("function"==typeof t)var n=t(o)||o,u=n[0],s=n[1];else if(t&&t!==document.body)var f=a(t),u=0|f[0],s=0|f[1];else var u=window.innerWidth,s=window.innerHeight;return i?(e.setAttribute("width",u*r.scale+"px"),e.setAttribute("height",s*r.scale+"px")):(e.width=u*r.scale,e.height=s*r.scale),e.style.width=u+"px",e.style.height=s+"px",r}var i="SVG"===e.nodeName.toUpperCase();return e.style.position=e.style.position||"absolute",e.style.top=0,e.style.left=0,r.scale=parseFloat(n||1),r.parent=t,r()}var a=n(17);e.exports=r;var o=new Float32Array(2)},function(e,t,n){function r(e,t){function n(){var n=s("<control>")||s("<alt>"),a=s("<shift>"),o=e.height,i=e.width;if(t.rotate&&l.left&&!n&&!a&&d.rotate([c.x/i-.5,c.y/o-.5],[c.prevX/i-.5,c.prevY/o-.5]),(t.pan&&l.right||l.left&&n&&!a)&&d.pan([f*(c.x-c.prevX)/i,f*(c.y-c.prevY)/o]),t.scale&&r[1]&&(d.distance*=Math.exp(r[1]/o)),t.scale&&(l.middle||l.left&&!n&&a)){var u=c.y-c.prevY;if(!u)return;d.distance*=Math.exp(u/o)}r.flush(),c.flush()}t=t||{},t.pan=!1!==t.pan,t.scale=!1!==t.scale,t.rotate=!1!==t.rotate;var r=o(e,t.scale),l=u(e,t.rotate),c=i(e),d=a([0,10,30],[0,0,0],[0,1,0]);return d.tick=n,d}var a=n(49),o=n(51),i=n(47),u=n(48),s=n(46),f=1;e.exports=r},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){"use strict";function e(e){return"undefined"!=typeof btoa?btoa(e):"base64:"+e}function t(e){var t=new Error("(regl) "+e);throw console.error(t),t}function n(e,n){e||t(n)}function r(e){return e?": "+e:""}function a(e,n,a){e in n||t("unknown parameter ("+e+")"+r(a)+". possible values: "+Object.keys(n).join())}function o(e,n){Ke(e)||t("invalid parameter type"+r(n)+". must be a typed array")}function i(e,n,a){typeof e!==n&&t("invalid parameter type"+r(a)+". expected "+n+", got "+typeof e)}function u(e,n){e>=0&&(0|e)===e||t("invalid parameter type, ("+e+")"+r(n)+". must be a nonnegative integer")}function s(e,n,a){n.indexOf(e)<0&&t("invalid value"+r(a)+". must be one of: "+n)}function f(e){Object.keys(e).forEach(function(e){et.indexOf(e)<0&&t('invalid regl constructor argument "'+e+'". must be one of '+et)})}function l(e,t){for(e+="";e.length<t;)e=" "+e;return e}function c(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function d(e,t){this.number=e,this.line=t,this.errors=[]}function m(e,t,n){this.file=e,this.line=t,this.message=n}function h(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function p(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function b(t,n){var r=t.split("\n"),a=1,o=0,i={unknown:new c,0:new c};i.unknown.name=i[0].name=n||h(),i.unknown.lines.push(new d(0,""));for(var u=0;u<r.length;++u){var s=r[u],f=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(s);if(f)switch(f[1]){case"line":var l=/(\d+)(\s+\d+)?/.exec(f[2]);l&&(a=0|l[1],l[2]&&((o=0|l[2])in i||(i[o]=new c)));break;case"define":var m=/SHADER_NAME(_B64)?\s+(.*)$/.exec(f[2]);m&&(i[o].name=m[1]?e(m[2]):m[2])}i[o].lines.push(new d(a++,s))}return Object.keys(i).forEach(function(e){var t=i[e];t.lines.forEach(function(e){t.index[e.number]=e})}),i}function v(e){var t=[];return e.split("\n").forEach(function(e){if(!(e.length<5)){var n=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);n?t.push(new m(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new m("unknown",0,e))}}),t}function x(e,t){t.forEach(function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}function g(e,t,r,a,o){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(t),u=a===e.FRAGMENT_SHADER?"fragment":"vertex";F(r,"string",u+" shader source must be a string",o);var s=b(r,o),f=v(i);x(s,f),Object.keys(s).forEach(function(e){function t(e,t){r.push(e),a.push(t||"")}var n=s[e];if(n.hasErrors){var r=[""],a=[""];t("file number "+e+": "+n.name+"\n","color:red;text-decoration:underline;font-weight:bold"),n.lines.forEach(function(e){if(e.errors.length>0){t(l(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),t(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var n=0;e.errors.forEach(function(r){var a=r.message,o=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(a);if(o){var i=o[1];switch(a=o[2],i){case"assign":i="="}n=Math.max(e.line.indexOf(i,n),0)}else n=0;t(l("| ",6)),t(l("^^^",n+3)+"\n","font-weight:bold"),t(l("| ",6)),t(a+"\n","font-weight:bold")}),t(l("| ",6)+"\n")}else t(l(e.number,4)+"|  "),t(e.line+"\n","color:red")}),"undefined"!=typeof document?(a[0]=r.join("%c"),console.log.apply(console,a)):console.log(r.join(""))}}),n.raise("Error compiling "+u+" shader, "+s[0].name)}}function y(e,t,r,a,o){if(!e.getProgramParameter(t,e.LINK_STATUS)){var i=e.getProgramInfoLog(t),u=b(r,o),s=b(a,o),f='Error linking program with vertex shader, "'+s[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+f+"\n%c"+i,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(f+"\n"+i),n.raise(f)}}function M(e){e._commandRef=h()}function S(e,t,n,r){function a(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach(function(t){e[r.id(t)]=!0})}M(e),e._fragId=a(e.static.frag),e._vertId=a(e.static.vert);var i=e._uniformSet={};o(i,t.static),o(i,t.dynamic);var u=e._attributeSet={};o(u,n.static),o(u,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function w(e,n){var r=p();t(e+" in command "+(n||h())+("unknown"===r?"":" called from "+r))}function D(e,t,n){e||w(t,n||h())}function I(e,t,n,a){e in t||w("unknown parameter ("+e+")"+r(n)+". possible values: "+Object.keys(t).join(),a||h())}function F(e,t,n,a){typeof e!==t&&w("invalid parameter type"+r(n)+". expected "+t+", got "+typeof e,a||h())}function A(e){e()}function _(e,t,n){e.texture?s(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):s(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}function E(e,t){return e===ft||e===st||e===lt?2:e===ct?4:dt[e]*t}function k(e){return!(e&e-1||!e)}function T(e,t,r){var a,o=t.width,i=t.height,u=t.channels;n(o>0&&o<=r.maxTextureSize&&i>0&&i<=r.maxTextureSize,"invalid texture shape"),e.wrapS===tt&&e.wrapT===tt||n(k(o)&&k(i),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==i&&n(e.minFilter!==rt&&e.minFilter!==ot&&e.minFilter!==at&&e.minFilter!==it,"min filter requires mipmap"):(n(k(o)&&k(i),"texture must be a square power of 2 to support mipmapping"),n(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),t.type===ut&&(r.extensions.indexOf("oes_texture_float_linear")<0&&n(e.minFilter===nt&&e.magFilter===nt,"filter not supported, must enable oes_texture_float_linear"),n(!e.genMipmaps,"mipmap generation not supported with float textures"));var s=t.images;for(a=0;a<16;++a)if(s[a]){var f=o>>a,l=i>>a;n(t.mipmask&1<<a,"missing mipmap data");var c=s[a];if(n(c.width===f&&c.height===l,"invalid shape for mip images"),n(c.format===t.format&&c.internalformat===t.internalformat&&c.type===t.type,"incompatible type for mip image"),c.compressed);else if(c.data){var d=Math.ceil(E(c.type,u)*f/c.unpackAlignment)*c.unpackAlignment;n(c.data.byteLength===d*l,"invalid data for image, buffer size is inconsistent with image format")}else c.element||c.copy}else e.genMipmaps||n(0==(t.mipmask&1<<a),"extra mipmap data");t.compressed&&n(!e.genMipmaps,"mipmap generation for compressed images not supported")}function z(e,t,r,a){var o=e.width,i=e.height,u=e.channels;n(o>0&&o<=a.maxTextureSize&&i>0&&i<=a.maxTextureSize,"invalid texture shape"),n(o===i,"cube map must be square"),n(t.wrapS===tt&&t.wrapT===tt,"wrap mode not supported by cube map");for(var s=0;s<r.length;++s){var f=r[s];n(f.width===o&&f.height===i,"inconsistent cube map face shape"),t.genMipmaps&&(n(!f.compressed,"can not generate mipmap for compressed textures"),n(1===f.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=f.images,c=0;c<16;++c){var d=l[c];if(d){var m=o>>c,h=i>>c;n(f.mipmask&1<<c,"missing mipmap data"),n(d.width===m&&d.height===h,"invalid shape for mip images"),n(d.format===e.format&&d.internalformat===e.internalformat&&d.type===e.type,"incompatible type for mip image"),d.compressed||(d.data?n(d.data.byteLength===m*h*Math.max(E(d.type,u),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}function O(e,t){this.id=ht++,this.type=e,this.data=t}function P(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function C(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+P(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return C(e.substr(0,r.index)).concat(C(r[1])).concat(C(e.substr(r.index+r[0].length)));var a=e.split(".");if(1===a.length)return['"'+P(e)+'"'];for(var o=[],i=0;i<a.length;++i)o=o.concat(C(a[i]));return o}function j(e){return"["+C(e).join("][")+"]"}function L(e,t){return new O(e,j(t+""))}function R(e){return"function"==typeof e&&!e._reglType||e instanceof O}function q(e,t){return"function"==typeof e?new O(pt,e):e}function N(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}function B(e,t,n){function r(){var t=window.innerWidth,r=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();t=a.right-a.left,r=a.bottom-a.top}o.width=n*t,o.height=n*r,Je(o.style,{width:t+"px",height:r+"px"})}function a(){window.removeEventListener("resize",r),e.removeChild(o)}var o=document.createElement("canvas");return Je(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",Je(e.style,{margin:0,padding:0})),window.addEventListener("resize",r,!1),r(),{canvas:o,onDestroy:a}}function Y(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function U(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}function V(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}function W(e){return"string"==typeof e?e.split():(mt(Array.isArray(e),"invalid extension array"),e)}function H(e){return"string"==typeof e?(mt("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function G(e){var t,n,r,a,o=e||{},i={},u=[],s=[],f="undefined"==typeof window?1:window.devicePixelRatio,l=!1,c=function(e){e&&mt.raise(e)},d=function(){};if("string"==typeof o?(mt("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),t=document.querySelector(o),mt(t,"invalid query string for element")):"object"==typeof o?U(o)?t=o:V(o)?(a=o,r=a.canvas):(mt.constructor(o),"gl"in o?a=o.gl:"canvas"in o?r=H(o.canvas):"container"in o&&(n=H(o.container)),"attributes"in o&&(i=o.attributes,mt.type(i,"object","invalid context attributes")),"extensions"in o&&(u=W(o.extensions)),"optionalExtensions"in o&&(s=W(o.optionalExtensions)),"onDone"in o&&(mt.type(o.onDone,"function","invalid or missing onDone callback"),c=o.onDone),"profile"in o&&(l=!!o.profile),"pixelRatio"in o&&(f=+o.pixelRatio,mt(f>0,"invalid pixel ratio"))):mt.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?r=t:n=t),!a){if(!r){mt("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var m=B(n||document.body,c,f);if(!m)return null;r=m.canvas,d=m.onDestroy}a=Y(r,i)}return a?{gl:a,canvas:r,container:n,extensions:u,optionalExtensions:s,pixelRatio:f,profile:l,onDone:c,onDestroy:d}:(d(),c("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function X(e,t){function n(t){mt.type(t,"string","extension name must be string");var n,a=t.toLowerCase();try{n=r[a]=e.getExtension(a)}catch(e){}return!!n}for(var r={},a=0;a<t.extensions.length;++a){var o=t.extensions[a];if(!n(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach(function(e){if(!n(e))throw new Error("(regl): error restoring extension "+e)})}}}function Q(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||Ke(e.data))}function Z(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function $(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function K(e){var t,n;return t=(e>65535)<<4,e>>>=t,n=(e>255)<<3,e>>>=n,t|=n,n=(e>15)<<2,e>>>=n,t|=n,n=(e>3)<<1,e>>>=n,(t|=n)|e>>1}function J(e){var t=$(e),n=_t[K(t)>>2];return n.length>0?n.pop():new ArrayBuffer(t)}function ee(e){_t[K(e.byteLength)>>2].push(e)}function te(e,t){var n=null;switch(e){case Mt:n=new Int8Array(J(t),0,t);break;case St:n=new Uint8Array(J(t),0,t);break;case wt:n=new Int16Array(J(2*t),0,t);break;case Dt:n=new Uint16Array(J(2*t),0,t);break;case It:n=new Int32Array(J(4*t),0,t);break;case Ft:n=new Uint32Array(J(4*t),0,t);break;case At:n=new Float32Array(J(4*t),0,t);break;default:return null}return n.length!==t?n.subarray(0,t):n}function ne(e){ee(e.buffer)}function re(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}function ae(e,t,n,r){for(var a=0,o=0;o<t;++o)for(var i=e[o],u=0;u<n;++u)r[a++]=i[u]}function oe(e,t,n,r,a,o){for(var i=o,u=0;u<t;++u)for(var s=e[u],f=0;f<n;++f)for(var l=s[f],c=0;c<r;++c)a[i++]=l[c]}function ie(e,t,n,r,a){for(var o=1,i=n+1;i<t.length;++i)o*=t[i];var u=t[n];if(t.length-n==4){var s=t[n+1],f=t[n+2],l=t[n+3];for(i=0;i<u;++i)oe(e[i],s,f,l,r,a),a+=o}else for(i=0;i<u;++i)ie(e[i],t,n+1,r,a),a+=o}function ue(e,t,n,r){var a=1;if(t.length)for(var o=0;o<t.length;++o)a*=t[o];else a=0;var i=r||Et.allocType(n,a);switch(t.length){case 0:break;case 1:re(e,t[0],i);break;case 2:ae(e,t[0],t[1],i);break;case 3:oe(e,t[0],t[1],t[2],i,0);break;default:ie(e,t,0,i,0)}return i}function se(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t}function fe(e){return 0|$e[Object.prototype.toString.call(e)]}function le(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function ce(e,t,n,r,a,o,i){for(var u=0,s=0;s<n;++s)for(var f=0;f<r;++f)e[u++]=t[a*s+o*f+i]}function de(e,t,n){function r(t){this.id=c++,this.buffer=e.createBuffer(),this.type=t,this.usage=Ct,this.byteLength=0,this.dimension=1,this.dtype=Lt,this.persistentData=null,n.profile&&(this.stats={size:0})}function a(e,t){var n=m.pop();return n||(n=new r(e)),n.bind(),u(n,t,jt,0,1,!1),n}function o(e){m.push(e)}function i(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function u(e,t,n,r,a,o){var u;if(e.usage=n,Array.isArray(t)){if(e.dtype=r||Rt,t.length>0){var s;if(Array.isArray(t[0])){u=Pt(t);for(var f=1,l=1;l<u.length;++l)f*=u[l];e.dimension=f,s=Ot(t,u,e.dtype),i(e,s,n),o?e.persistentData=s:Et.freeType(s)}else if("number"==typeof t[0]){e.dimension=a;var c=Et.allocType(e.dtype,t.length);le(c,t),i(e,c,n),o?e.persistentData=c:Et.freeType(c)}else Ke(t[0])?(e.dimension=t[0].length,e.dtype=r||fe(t[0])||Rt,s=Ot(t,[t.length,t[0].length],e.dtype),i(e,s,n),o?e.persistentData=s:Et.freeType(s)):mt.raise("invalid buffer data")}}else if(Ke(t))e.dtype=r||fe(t),e.dimension=a,i(e,t,n),o&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)));else if(Q(t)){u=t.shape;var d=t.stride,m=t.offset,h=0,p=0,b=0,v=0;1===u.length?(h=u[0],p=1,b=d[0],v=0):2===u.length?(h=u[0],p=u[1],b=d[0],v=d[1]):mt.raise("invalid shape"),e.dtype=r||fe(t.data)||Rt,e.dimension=p;var x=Et.allocType(e.dtype,h*p);ce(x,t.data,h,p,b,v,m),i(e,x,n),o?e.persistentData=x:Et.freeType(x)}else mt.raise("invalid buffer data")}function s(n){t.bufferCount--;var r=n.buffer;mt(r,"buffer must not be deleted already"),e.deleteBuffer(r),n.buffer=null,delete d[n.id]}function f(a,o,i,f){function l(t){var r=Ct,a=null,o=0,i=0,s=1;return Array.isArray(t)||Ke(t)||Q(t)?a=t:"number"==typeof t?o=0|t:t&&(mt.type(t,"object","buffer arguments must be an object, a number or an array"),"data"in t&&(mt(null===a||Array.isArray(a)||Ke(a)||Q(a),"invalid data for buffer"),a=t.data),"usage"in t&&(mt.parameter(t.usage,zt,"invalid buffer usage"),r=zt[t.usage]),"type"in t&&(mt.parameter(t.type,Tt,"invalid buffer type"),i=Tt[t.type]),"dimension"in t&&(mt.type(t.dimension,"number","invalid dimension"),s=0|t.dimension),"length"in t&&(mt.nni(o,"buffer length must be a nonnegative integer"),o=0|t.length)),h.bind(),a?u(h,a,r,i,s,f):(e.bufferData(h.type,o,r),h.dtype=i||Lt,h.usage=r,h.dimension=s,h.byteLength=o),n.profile&&(h.stats.size=h.byteLength*qt[h.dtype]),l}function c(t,n){mt(n+t.byteLength<=h.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+h.byteLength),e.bufferSubData(h.type,n,t)}function m(e,t){var n,r=0|(t||0);if(h.bind(),Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var a=Et.allocType(h.dtype,e.length);le(a,e),c(a,r),Et.freeType(a)}else if(Array.isArray(e[0])||Ke(e[0])){n=Pt(e);var o=Ot(e,n,h.dtype);c(o,r),Et.freeType(o)}else mt.raise("invalid buffer data")}else if(Ke(e))c(e,r);else if(Q(e)){n=e.shape;var i=e.stride,u=0,s=0,f=0,d=0;1===n.length?(u=n[0],s=1,f=i[0],d=0):2===n.length?(u=n[0],s=n[1],f=i[0],d=i[1]):mt.raise("invalid shape");var m=Array.isArray(e.data)?h.dtype:fe(e.data),p=Et.allocType(m,u*s);ce(p,e.data,u,s,f,d,e.offset),c(p,r),Et.freeType(p)}else mt.raise("invalid data for buffer subdata");return l}t.bufferCount++;var h=new r(o);return d[h.id]=h,i||l(a),l._reglType="buffer",l._buffer=h,l.subdata=m,n.profile&&(l.stats=h.stats),l.destroy=function(){s(h)},l}function l(){yt(d).forEach(function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)})}var c=0,d={};r.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},r.prototype.destroy=function(){s(this)};var m=[];return n.profile&&(t.getTotalBufferSize=function(){var e=0;return Object.keys(d).forEach(function(t){e+=d[t].stats.size}),e}),{create:f,createStream:a,destroyStream:o,clear:function(){yt(d).forEach(s),m.forEach(s)},getBuffer:function(e){return e&&e._buffer instanceof r?e._buffer:null},restore:l,_initBuffer:u}}function me(e,t,n,r){function a(e){this.id=c++,l[this.id]=this,this.buffer=e,this.primType=Ut,this.vertCount=0,this.type=0}function o(e){var t=m.pop();return t||(t=new a(n.create(null,Zt,!0,!1)._buffer)),u(t,e,$t,-1,-1,0,0),t}function i(e){m.push(e)}function u(r,a,o,i,u,s,f){if(r.buffer.bind(),a){var l=f;f||Ke(a)&&(!Q(a)||Ke(a.data))||(l=t.oes_element_index_uint?Qt:Gt),n._initBuffer(r.buffer,a,o,l,3)}else e.bufferData(Zt,s,o),r.buffer.dtype=c||Wt,r.buffer.usage=o,r.buffer.dimension=3,r.buffer.byteLength=s;var c=f;if(!f){switch(r.buffer.dtype){case Wt:case Vt:c=Wt;break;case Gt:case Ht:c=Gt;break;case Qt:case Xt:c=Qt;break;default:mt.raise("unsupported type for element array")}r.buffer.dtype=c}r.type=c,mt(c!==Qt||!!t.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=u;d<0&&(d=r.buffer.byteLength,c===Gt?d>>=1:c===Qt&&(d>>=2)),r.vertCount=d;var m=i;if(i<0){m=Ut;var h=r.buffer.dimension;1===h&&(m=Bt),2===h&&(m=Yt),3===h&&(m=Ut)}r.primType=m}function s(e){r.elementsCount--,mt(null!==e.buffer,"must not double destroy elements"),delete l[e.id],e.buffer.destroy(),e.buffer=null}function f(e,t){function o(e){if(e)if("number"==typeof e)i(e),f.primType=Ut,f.vertCount=0|e,f.type=Wt;else{var t=null,n=Kt,r=-1,a=-1,s=0,l=0;Array.isArray(e)||Ke(e)||Q(e)?t=e:(mt.type(e,"object","invalid arguments for elements"),"data"in e&&(t=e.data,mt(Array.isArray(t)||Ke(t)||Q(t),"invalid data for element buffer")),"usage"in e&&(mt.parameter(e.usage,zt,"invalid element buffer usage"),n=zt[e.usage]),"primitive"in e&&(mt.parameter(e.primitive,Nt,"invalid element buffer primitive"),r=Nt[e.primitive]),"count"in e&&(mt("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),a=0|e.count),"type"in e&&(mt.parameter(e.type,d,"invalid buffer type"),l=d[e.type]),"length"in e?s=0|e.length:(s=a,l===Gt||l===Ht?s*=2:l!==Qt&&l!==Xt||(s*=4))),u(f,t,n,r,a,s,l)}else i(),f.primType=Ut,f.vertCount=0,f.type=Wt;return o}var i=n.create(null,Zt,!0),f=new a(i._buffer);return r.elementsCount++,o(e),o._reglType="elements",o._elements=f,o.subdata=function(e,t){return i.subdata(e,t),o},o.destroy=function(){s(f)},o}var l={},c=0,d={uint8:Wt,uint16:Gt};t.oes_element_index_uint&&(d.uint32=Qt),a.prototype.bind=function(){this.buffer.bind()};var m=[];return{create:f,createStream:o,destroyStream:i,getElements:function(e){return"function"==typeof e&&e._elements instanceof a?e._elements:null},clear:function(){yt(l).forEach(s)}}}function he(e){for(var t=Et.allocType(tn,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{Jt[0]=e[n];var r=en[0],a=r>>>31<<15,o=(r<<1>>>24)-127,i=r>>13&1023;if(o<-24)t[n]=a;else if(o<-14){var u=-14-o;t[n]=a+(i+1024>>u)}else t[n]=o>15?a+31744:a+(o+15<<10)+i}return t}function pe(e){return Array.isArray(e)||Ke(e)}function be(e){return"[object "+e+"]"}function ve(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function xe(e){return!!Array.isArray(e)&&!(0===e.length||!pe(e[0]))}function ge(e){return Object.prototype.toString.call(e)}function ye(e){return ge(e)===mr}function Me(e){return ge(e)===hr}function Se(e){return ge(e)===pr}function we(e){return ge(e)===br}function De(e){if(!e)return!1;var t=ge(e);return vr.indexOf(t)>=0||(ve(e)||xe(e)||Q(e))}function Ie(e){return 0|$e[Object.prototype.toString.call(e)]}function Fe(e,t){var n=t.length;switch(e.type){case jn:case Ln:case Rn:case qn:var r=Et.allocType(e.type,n);r.set(t),e.data=r;break;case wn:e.data=he(t);break;default:mt.raise("unsupported texture type, must specify a typed array")}}function Ae(e,t){return Et.allocType(e.type===wn?qn:e.type,t)}function _e(e,t){e.type===wn?(e.data=he(t),Et.freeType(t)):e.data=t}function Ee(e,t,n,r,a,o){for(var i=e.width,u=e.height,s=e.channels,f=i*u*s,l=Ae(e,f),c=0,d=0;d<u;++d)for(var m=0;m<i;++m)for(var h=0;h<s;++h)l[c++]=t[n*m+r*d+a*h+o];_e(e,l)}function ke(e,t,n,r,a,o){var i;if(i=void 0!==gr[e]?gr[e]:dr[e]*xr[t],o&&(i*=6),a){for(var u=0,s=n;s>=1;)u+=i*s*s,s/=2;return u}return i*n*r}function Te(e,t,n,r,a,o,i){function u(){this.internalformat=un,this.format=un,this.type=jn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=0,this.width=0,this.height=0,this.channels=0}function s(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function f(e,r){if("object"==typeof r&&r){if("premultiplyAlpha"in r&&(mt.type(r.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=r.premultiplyAlpha),"flipY"in r&&(mt.type(r.flipY,"boolean","invalid texture flip"),e.flipY=r.flipY),"alignment"in r&&(mt.oneOf(r.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=r.alignment),"colorSpace"in r&&(mt.parameter(r.colorSpace,R,"invalid colorSpace"),e.colorSpace=R[r.colorSpace]),"type"in r){var a=r.type;mt(t.oes_texture_float||!("float"===a||"float32"===a),"you must enable the OES_texture_float extension in order to use floating point textures."),mt(t.oes_texture_half_float||!("half float"===a||"float16"===a),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),mt(t.webgl_depth_texture||!("uint16"===a||"uint32"===a||"depth stencil"===a),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),mt.parameter(a,q,"invalid texture type"),e.type=q[a]}var o=e.width,i=e.height,u=e.channels,s=!1;"shape"in r?(mt(Array.isArray(r.shape)&&r.shape.length>=2,"shape must be an array"),o=r.shape[0],i=r.shape[1],3===r.shape.length&&(u=r.shape[2],mt(u>0&&u<=4,"invalid number of channels"),s=!0),mt(o>=0&&o<=n.maxTextureSize,"invalid width"),mt(i>=0&&i<=n.maxTextureSize,"invalid height")):("radius"in r&&(o=i=r.radius,mt(o>=0&&o<=n.maxTextureSize,"invalid radius")),"width"in r&&(o=r.width,mt(o>=0&&o<=n.maxTextureSize,"invalid width")),"height"in r&&(i=r.height,mt(i>=0&&i<=n.maxTextureSize,"invalid height")),"channels"in r&&(u=r.channels,mt(u>0&&u<=4,"invalid number of channels"),s=!0)),e.width=0|o,e.height=0|i,e.channels=0|u;var f=!1;if("format"in r){var l=r.format;mt(t.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),mt.parameter(l,N,"invalid texture format");var c=e.internalformat=N[l];e.format=Z[c],l in q&&("type"in r||(e.type=q[l])),l in B&&(e.compressed=!0),f=!0}!s&&f?e.channels=dr[e.format]:s&&!f?e.channels!==cr[e.format]&&(e.format=e.internalformat=cr[e.channels]):f&&s&&mt(e.channels===dr[e.format],"number of channels inconsistent with specified format")}}function l(t){e.pixelStorei(or,t.flipY),e.pixelStorei(ir,t.premultiplyAlpha),e.pixelStorei(ur,t.colorSpace),e.pixelStorei(ar,t.unpackAlignment)}function c(){u.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function d(e,t){var r=null;if(De(t)?r=t:t&&(mt.type(t,"object","invalid pixel data type"),f(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),De(t.data)&&(r=t.data)),mt(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),t.copy){mt(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,i=a.viewportHeight;e.width=e.width||o-e.xOffset,e.height=e.height||i-e.yOffset,e.needsCopy=!0,mt(e.xOffset>=0&&e.xOffset<o&&e.yOffset>=0&&e.yOffset<i&&e.width>0&&e.width<=o&&e.height>0&&e.height<=i,"copy texture read out of bounds")}else if(r){if(Ke(r))e.channels=e.channels||4,e.data=r,"type"in t||e.type!==jn||(e.type=Ie(r));else if(ve(r))e.channels=e.channels||4,Fe(e,r),e.alignment=1,e.needsFree=!0;else if(Q(r)){var u=r.data;Array.isArray(u)||e.type!==jn||(e.type=Ie(u));var s,l,c,d,m,h,p=r.shape,b=r.stride;3===p.length?(c=p[2],h=b[2]):(mt(2===p.length,"invalid ndarray pixel data, must be 2 or 3D"),c=1,h=1),s=p[0],l=p[1],d=b[0],m=b[1],e.alignment=1,e.width=s,e.height=l,e.channels=c,e.format=e.internalformat=cr[c],e.needsFree=!0,Ee(e,u,d,m,h,r.offset)}else if(ye(r)||Me(r))ye(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(Se(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(we(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(xe(r)){var v=e.width||r[0].length,x=e.height||r.length,g=e.channels;g=pe(r[0][0])?g||r[0][0].length:g||1;for(var y=kt.shape(r),M=1,S=0;S<y.length;++S)M*=y[S];var w=Ae(e,M);kt.flatten(r,y,"",w),_e(e,w),e.alignment=1,e.width=v,e.height=x,e.channels=g,e.format=e.internalformat=cr[g],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===qn?mt(n.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===wn&&mt(n.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function m(t,n,a){var o=t.element,i=t.data,u=t.internalformat,s=t.format,f=t.type,c=t.width,d=t.height;l(t),o?e.texImage2D(n,a,s,s,f,o):t.compressed?e.compressedTexImage2D(n,a,u,c,d,0,i):t.needsCopy?(r(),e.copyTexImage2D(n,a,s,t.xOffset,t.yOffset,c,d,0)):e.texImage2D(n,a,s,c,d,0,s,f,i)}function h(t,n,a,o,i){var u=t.element,s=t.data,f=t.internalformat,c=t.format,d=t.type,m=t.width,h=t.height;l(t),u?e.texSubImage2D(n,i,a,o,c,d,u):t.compressed?e.compressedTexSubImage2D(n,i,a,o,f,m,h,s):t.needsCopy?(r(),e.copyTexSubImage2D(n,i,a,o,t.xOffset,t.yOffset,m,h)):e.texSubImage2D(n,i,a,o,m,h,c,d,s)}function p(){return $.pop()||new c}function b(e){e.needsFree&&Et.freeType(e.data),c.call(e),$.push(e)}function v(){u.call(this),this.genMipmaps=!1,this.mipmapHint=er,this.mipmask=0,this.images=Array(16)}function x(e,t,n){var r=e.images[0]=p();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function g(e,t){var n=null;if(De(t))n=e.images[0]=p(),s(n,e),d(n,t),e.mipmask=1;else if(f(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,a=0;a<r.length;++a)n=e.images[a]=p(),s(n,e),n.width>>=a,n.height>>=a,d(n,r[a]),e.mipmask|=1<<a;else n=e.images[0]=p(),s(n,e),d(n,t),e.mipmask=1;s(e,e.images[0]),(e.compressed&&e.internalformat===Dn||e.internalformat===In||e.internalformat===Fn||e.internalformat===An)&&mt(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function y(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;m(n[r],t,r)}}function M(){var e=K.pop()||new v;u.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function S(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&b(t[n]),t[n]=null;K.push(e)}function w(){this.minFilter=Gn,this.magFilter=Gn,this.wrapS=Un,this.wrapT=Un,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=er}function D(e,t){if("min"in t){var r=t.min;mt.parameter(r,L),e.minFilter=L[r],lr.indexOf(e.minFilter)>=0&&(e.genMipmaps=!0)}if("mag"in t){var a=t.mag;mt.parameter(a,j),e.magFilter=j[a]}var o=e.wrapS,i=e.wrapT;if("wrap"in t){var u=t.wrap;"string"==typeof u?(mt.parameter(u,C),o=i=C[u]):Array.isArray(u)&&(mt.parameter(u[0],C),mt.parameter(u[1],C),o=C[u[0]],i=C[u[1]])}else{if("wrapS"in t){var s=t.wrapS;mt.parameter(s,C),o=C[s]}if("wrapT"in t){var f=t.wrapT;mt.parameter(f,C),i=C[f]}}if(e.wrapS=o,e.wrapT=i,"anisotropic"in t){var l=t.anisotropic;mt("number"==typeof l&&l>=1&&l<=n.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var c=!1;switch(typeof t.mipmap){case"string":mt.parameter(t.mipmap,P,"invalid mipmap hint"),e.mipmapHint=P[t.mipmap],e.genMipmaps=!0,c=!0;break;case"boolean":c=e.genMipmaps=t.mipmap;break;case"object":mt(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,c=!0;break;default:mt.raise("invalid mipmap type")}!c||"min"in t||(e.minFilter=Qn)}}function I(n,r){e.texParameteri(r,Hn,n.minFilter),e.texParameteri(r,Wn,n.magFilter),e.texParameteri(r,Nn,n.wrapS),e.texParameteri(r,Bn,n.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(r,rr,n.anisotropic),n.genMipmaps&&(e.hint(Jn,n.mipmapHint),e.generateMipmap(r))}function F(t){u.call(this),this.mipmask=0,this.internalformat=un,this.id=J++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new w,i.profile&&(this.stats={size:0})}function A(t){e.activeTexture(fr),e.bindTexture(t.target,t.texture)}function _(){var t=ne[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(rn,null)}function E(t){var n=t.texture;mt(n,"must not double destroy texture");var r=t.unit,a=t.target;r>=0&&(e.activeTexture(fr+r),e.bindTexture(a,null),ne[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete ee[t.id],o.textureCount--}function k(t,r){function a(e,t){var r=l.texInfo;w.call(r);var o=M();return"number"==typeof e?"number"==typeof t?x(o,0|e,0|t):x(o,0|e,0|e):e?(mt.type(e,"object","invalid arguments to regl.texture"),D(r,e),g(o,e)):x(o,1,1),r.genMipmaps&&(o.mipmask=(o.width<<1)-1),l.mipmask=o.mipmask,s(l,o),mt.texture2D(r,o,n),l.internalformat=o.internalformat,a.width=o.width,a.height=o.height,A(l),y(o,rn),I(r,rn),_(),S(o),i.profile&&(l.stats.size=ke(l.internalformat,l.type,o.width,o.height,r.genMipmaps,!1)),a.format=V[l.internalformat],a.type=W[l.type],a.mag=H[r.magFilter],a.min=G[r.minFilter],a.wrapS=X[r.wrapS],a.wrapT=X[r.wrapT],a}function u(e,t,n,r){mt(!!e,"must specify image data");var o=0|t,i=0|n,u=0|r,f=p();return s(f,l),f.width=0,f.height=0,d(f,e),f.width=f.width||(l.width>>u)-o,f.height=f.height||(l.height>>u)-i,mt(l.type===f.type&&l.format===f.format&&l.internalformat===f.internalformat,"incompatible format for texture.subimage"),mt(o>=0&&i>=0&&o+f.width<=l.width&&i+f.height<=l.height,"texture.subimage write out of bounds"),mt(l.mipmask&1<<u,"missing mipmap data"),mt(f.data||f.element||f.needsCopy,"missing image data"),A(l),h(f,rn,o,i,u),_(),b(f),a}function f(t,n){var r=0|t,o=0|n||r;if(r===l.width&&o===l.height)return a;a.width=l.width=r,a.height=l.height=o,A(l);for(var u=0;l.mipmask>>u;++u)e.texImage2D(rn,u,l.format,r>>u,o>>u,0,l.format,l.type,null);return _(),i.profile&&(l.stats.size=ke(l.internalformat,l.type,r,o,!1,!1)),a}var l=new F(rn);return ee[l.id]=l,o.textureCount++,a(t,r),a.subimage=u,a.resize=f,a._reglType="texture2d",a._texture=l,i.profile&&(a.stats=l.stats),a.destroy=function(){l.decRef()},a}function T(t,r,a,u,l,c){function m(e,t,r,a,o,u){var l,c=k.texInfo;for(w.call(c),l=0;l<6;++l)T[l]=M();if("number"!=typeof e&&e)if("object"==typeof e)if(t)g(T[0],e),g(T[1],t),g(T[2],r),g(T[3],a),g(T[4],o),g(T[5],u);else if(D(c,e),f(k,e),"faces"in e){var d=e.faces;for(mt(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),l=0;l<6;++l)mt("object"==typeof d[l]&&!!d[l],"invalid input for cube map face"),s(T[l],k),g(T[l],d[l])}else for(l=0;l<6;++l)g(T[l],e);else mt.raise("invalid arguments to cube map");else{var h=0|e||1;for(l=0;l<6;++l)x(T[l],h,h)}for(s(k,T[0]),c.genMipmaps?k.mipmask=(T[0].width<<1)-1:k.mipmask=T[0].mipmask,mt.textureCube(k,c,T,n),k.internalformat=T[0].internalformat,m.width=T[0].width,m.height=T[0].height,A(k),l=0;l<6;++l)y(T[l],on+l);for(I(c,an),_(),i.profile&&(k.stats.size=ke(k.internalformat,k.type,m.width,m.height,c.genMipmaps,!0)),m.format=V[k.internalformat],m.type=W[k.type],m.mag=H[c.magFilter],m.min=G[c.minFilter],m.wrapS=X[c.wrapS],m.wrapT=X[c.wrapT],l=0;l<6;++l)S(T[l]);return m}function v(e,t,n,r,a){mt(!!t,"must specify image data"),mt("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,i=0|r,u=0|a,f=p();return s(f,k),f.width=0,f.height=0,d(f,t),f.width=f.width||(k.width>>u)-o,f.height=f.height||(k.height>>u)-i,mt(k.type===f.type&&k.format===f.format&&k.internalformat===f.internalformat,"incompatible format for texture.subimage"),mt(o>=0&&i>=0&&o+f.width<=k.width&&i+f.height<=k.height,"texture.subimage write out of bounds"),mt(k.mipmask&1<<u,"missing mipmap data"),mt(f.data||f.element||f.needsCopy,"missing image data"),A(k),h(f,on+e,o,i,u),_(),b(f),m}function E(t){var n=0|t;if(n!==k.width){m.width=k.width=n,m.height=k.height=n,A(k);for(var r=0;r<6;++r)for(var a=0;k.mipmask>>a;++a)e.texImage2D(on+r,a,k.format,n>>a,n>>a,0,k.format,k.type,null);return _(),i.profile&&(k.stats.size=ke(k.internalformat,k.type,m.width,m.height,!1,!0)),m}}var k=new F(an);ee[k.id]=k,o.cubeCount++;var T=new Array(6);return m(t,r,a,u,l,c),m.subimage=v,m.resize=E,m._reglType="textureCube",m._texture=k,i.profile&&(m.stats=k.stats),m.destroy=function(){k.decRef()},m}function z(){for(var t=0;t<te;++t)e.activeTexture(fr+t),e.bindTexture(rn,null),ne[t]=null;yt(ee).forEach(E),o.cubeCount=0,o.textureCount=0}function O(){yt(ee).forEach(function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var n=0;n<32;++n)if(0!=(t.mipmask&1<<n))if(t.target===rn)e.texImage2D(rn,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)e.texImage2D(on+r,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);I(t.texInfo,t.target)})}var P={"don't care":er,"dont care":er,nice:nr,fast:tr},C={repeat:Yn,clamp:Un,mirror:Vn},j={nearest:Gn,linear:Xn},L=Je({mipmap:Kn,"nearest mipmap nearest":Qn,"linear mipmap nearest":Zn,"nearest mipmap linear":$n,"linear mipmap linear":Kn},j),R={none:0,browser:sr},q={uint8:jn,rgba4:pn,rgb565:vn,"rgb5 a1":bn},N={alpha:sn,luminance:ln,"luminance alpha":cn,rgb:fn,rgba:un,rgba4:dn,"rgb5 a1":mn,rgb565:hn},B={};t.ext_srgb&&(N.srgb=Mn,N.srgba=Sn),t.oes_texture_float&&(q.float32=q.float=qn),t.oes_texture_half_float&&(q.float16=q["half float"]=wn),t.webgl_depth_texture&&(Je(N,{depth:gn,"depth stencil":yn}),Je(q,{uint16:Ln,uint32:Rn,"depth stencil":xn})),t.webgl_compressed_texture_s3tc&&Je(B,{"rgb s3tc dxt1":Dn,"rgba s3tc dxt1":In,"rgba s3tc dxt3":Fn,"rgba s3tc dxt5":An}),t.webgl_compressed_texture_atc&&Je(B,{"rgb atc":_n,"rgba atc explicit alpha":En,"rgba atc interpolated alpha":kn}),t.webgl_compressed_texture_pvrtc&&Je(B,{"rgb pvrtc 4bppv1":Tn,"rgb pvrtc 2bppv1":zn,"rgba pvrtc 4bppv1":On,"rgba pvrtc 2bppv1":Pn}),t.webgl_compressed_texture_etc1&&(B["rgb etc1"]=Cn);var Y=Array.prototype.slice.call(e.getParameter(nn));Object.keys(B).forEach(function(e){var t=B[e];Y.indexOf(t)>=0&&(N[e]=t)});var U=Object.keys(N);n.textureFormats=U;var V=[];Object.keys(N).forEach(function(e){var t=N[e];V[t]=e});var W=[];Object.keys(q).forEach(function(e){var t=q[e];W[t]=e});var H=[];Object.keys(j).forEach(function(e){var t=j[e];H[t]=e});var G=[];Object.keys(L).forEach(function(e){var t=L[e];G[t]=e});var X=[];Object.keys(C).forEach(function(e){var t=C[e];X[t]=e});var Z=U.reduce(function(e,t){var n=N[t];return n===ln||n===sn||n===ln||n===cn||n===gn||n===yn?e[n]=n:n===mn||t.indexOf("rgba")>=0?e[n]=un:e[n]=fn,e},{}),$=[],K=[],J=0,ee={},te=n.maxTextureUnits,ne=Array(te).map(function(){return null});return Je(F.prototype,{bind:function(){var t=this;t.bindCount+=1;var n=t.unit;if(n<0){for(var r=0;r<te;++r){var a=ne[r];if(a){if(a.bindCount>0)continue;a.unit=-1}ne[r]=t,n=r;break}n>=te&&mt.raise("insufficient number of texture units"),i.profile&&o.maxTextureUnits<n+1&&(o.maxTextureUnits=n+1),t.unit=n,e.activeTexture(fr+n),e.bindTexture(t.target,t.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&E(this)}}),i.profile&&(o.getTotalTextureSize=function(){var e=0;return Object.keys(ee).forEach(function(t){e+=ee[t].stats.size}),e}),{create2D:k,createCube:T,clear:z,getTexture:function(e){return null},restore:O}}function ze(e,t,n){return Sr[e]*t*n}function Oe(e,t,n,r,a,o){function i(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,a=0;t?(r=t.width,a=t.height):n&&(r=n.width,a=n.height),this.width=r,this.height=a}function u(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function s(e,t,n){if(e)if(e.texture){var r=e.texture._texture,a=Math.max(1,r.width),o=Math.max(1,r.height);mt(a===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var i=e.renderbuffer._renderbuffer;mt(i.width===t&&i.height===n,"inconsistent width/height for renderbuffer"),i.refCount+=1}}function f(t,n){n&&(n.texture?e.framebufferTexture2D(Dr,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(Dr,t,Ir,n.renderbuffer._renderbuffer.renderbuffer))}function l(e){var t=Fr,n=null,r=null,a=e;"object"==typeof e&&(a=e.data,"target"in e&&(t=0|e.target)),mt.type(a,"function","invalid attachment data");var o=a._reglType;return"texture2d"===o?(n=a,mt(t===Fr)):"textureCube"===o?(n=a,mt(t>=Ar&&t<Ar+6,"invalid cube map target")):"renderbuffer"===o?(r=a,t=Ir):mt.raise("invalid regl object for attachment"),new i(t,n,r)}function c(e,t,n,o,u){if(n){var s=r.create2D({width:e,height:t,format:o,type:u});return s._texture.refCount=0,new i(Fr,s,null)}var f=a.create({width:e,height:t,format:o});return f._renderbuffer.refCount=0,new i(Ir,null,f)}function d(e){return e&&(e.texture||e.renderbuffer)}function m(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n))}function h(){this.id=I++,F[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function p(e){e.colorAttachments.forEach(u),u(e.depthAttachment),u(e.stencilAttachment),u(e.depthStencilAttachment)}function b(t){var n=t.framebuffer;mt(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,o.framebufferCount--,delete F[t.id]}function v(t){var r;e.bindFramebuffer(Dr,t.framebuffer);var a=t.colorAttachments;for(r=0;r<a.length;++r)f(_r+r,a[r]);for(r=a.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(Dr,_r+r,Fr,null,0);e.framebufferTexture2D(Dr,Tr,Fr,null,0),e.framebufferTexture2D(Dr,Er,Fr,null,0),e.framebufferTexture2D(Dr,kr,Fr,null,0),f(Er,t.depthAttachment),f(kr,t.stencilAttachment),f(Tr,t.depthStencilAttachment);var o=e.checkFramebufferStatus(Dr);o!==zr&&mt.raise("framebuffer configuration not supported, status = "+Br[o]),e.bindFramebuffer(Dr,M.next),M.cur=M.next,e.getError()}function x(e,r){function a(e,r){var o;mt(M.next!==u,"can not update framebuffer which is currently in use");var i=t.webgl_draw_buffers,f=0,m=0,h=!0,b=!0,x=null,g=!0,y="rgba",I="uint8",F=1,A=null,_=null,E=null,k=!1;if("number"==typeof e)f=0|e,m=0|r||f;else if(e){mt.type(e,"object","invalid arguments for framebuffer");var T=e;if("shape"in T){var z=T.shape;mt(Array.isArray(z)&&z.length>=2,"invalid shape for framebuffer"),f=z[0],m=z[1]}else"radius"in T&&(f=m=T.radius),"width"in T&&(f=T.width),"height"in T&&(m=T.height);("color"in T||"colors"in T)&&(x=T.color||T.colors,Array.isArray(x)&&mt(1===x.length||i,"multiple render targets not supported")),x||("colorCount"in T&&(F=0|T.colorCount,mt(F>0,"invalid color buffer count")),"colorTexture"in T&&(g=!!T.colorTexture,y="rgba4"),"colorType"in T&&(I=T.colorType,g?(mt(t.oes_texture_float||!("float"===I||"float32"===I),"you must enable OES_texture_float in order to use floating point framebuffer objects"),mt(t.oes_texture_half_float||!("half float"===I||"float16"===I),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===I||"float16"===I?(mt(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),y="rgba16f"):"float"!==I&&"float32"!==I||(mt(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),y="rgba32f"),mt.oneOf(I,D,"invalid color type")),"colorFormat"in T&&(y=T.colorFormat,S.indexOf(y)>=0?g=!0:w.indexOf(y)>=0?g=!1:g?mt.oneOf(T.colorFormat,S,"invalid color format for texture"):mt.oneOf(T.colorFormat,w,"invalid color format for renderbuffer"))),("depthTexture"in T||"depthStencilTexture"in T)&&(k=!(!T.depthTexture&&!T.depthStencilTexture),mt(!k||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in T&&("boolean"==typeof T.depth?h=T.depth:(A=T.depth,b=!1)),"stencil"in T&&("boolean"==typeof T.stencil?b=T.stencil:(_=T.stencil,h=!1)),"depthStencil"in T&&("boolean"==typeof T.depthStencil?h=b=T.depthStencil:(E=T.depthStencil,h=!1,b=!1))}else f=m=1;var O=null,P=null,C=null,j=null;if(Array.isArray(x))O=x.map(l);else if(x)O=[l(x)];else for(O=new Array(F),o=0;o<F;++o)O[o]=c(f,m,g,y,I);mt(t.webgl_draw_buffers||O.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),mt(O.length<=n.maxColorAttachments,"too many color attachments, not supported"),f=f||O[0].width,m=m||O[0].height,A?P=l(A):h&&!b&&(P=c(f,m,k,"depth","uint32")),_?C=l(_):b&&!h&&(C=c(f,m,!1,"stencil","uint8")),E?j=l(E):!A&&!_&&b&&h&&(j=c(f,m,k,"depth stencil","depth stencil")),mt(!!A+!!_+!!E<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var L=null;for(o=0;o<O.length;++o)if(s(O[o],f,m),mt(!O[o]||O[o].texture&&Pr.indexOf(O[o].texture._texture.format)>=0||O[o].renderbuffer&&Nr.indexOf(O[o].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+o+" is invalid"),O[o]&&O[o].texture){var R=Cr[O[o].texture._texture.format]*jr[O[o].texture._texture.type];null===L?L=R:mt(L===R,"all color attachments much have the same number of bits per pixel.")}return s(P,f,m),mt(!P||P.texture&&P.texture._texture.format===Or||P.renderbuffer&&P.renderbuffer._renderbuffer.format===Lr,"invalid depth attachment for framebuffer object"),s(C,f,m),mt(!C||C.renderbuffer&&C.renderbuffer._renderbuffer.format===Rr,"invalid stencil attachment for framebuffer object"),s(j,f,m),mt(!j||j.texture&&j.texture._texture.format===qr||j.renderbuffer&&j.renderbuffer._renderbuffer.format===qr,"invalid depth-stencil attachment for framebuffer object"),p(u),u.width=f,u.height=m,u.colorAttachments=O,u.depthAttachment=P,u.stencilAttachment=C,u.depthStencilAttachment=j,a.color=O.map(d),a.depth=d(P),a.stencil=d(C),a.depthStencil=d(j),a.width=u.width,a.height=u.height,v(u),a}function i(e,t){mt(M.next!==u,"can not resize a framebuffer which is currently in use");var n=0|e,r=0|t||n;if(n===u.width&&r===u.height)return a;for(var o=u.colorAttachments,i=0;i<o.length;++i)m(o[i],n,r);return m(u.depthAttachment,n,r),m(u.stencilAttachment,n,r),m(u.depthStencilAttachment,n,r),u.width=a.width=n,u.height=a.height=r,v(u),a}var u=new h;return o.framebufferCount++,a(e,r),Je(a,{resize:i,_reglType:"framebuffer",_framebuffer:u,destroy:function(){b(u),p(u)},use:function(e){M.setFBO({framebuffer:a},e)}})}function g(e){function a(e){var n;mt(i.indexOf(M.next)<0,"can not update framebuffer which is currently in use");var o=t.webgl_draw_buffers,u={color:null},s=0,f=null,l="rgba",c="uint8",d=1;if("number"==typeof e)s=0|e;else if(e){mt.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var h=m.shape;mt(Array.isArray(h)&&h.length>=2,"invalid shape for framebuffer"),mt(h[0]===h[1],"cube framebuffer must be square"),s=h[0]}else"radius"in m&&(s=0|m.radius),"width"in m?(s=0|m.width,"height"in m&&mt(m.height===s,"must be square")):"height"in m&&(s=0|m.height);("color"in m||"colors"in m)&&(f=m.color||m.colors,Array.isArray(f)&&mt(1===f.length||o,"multiple render targets not supported")),f||("colorCount"in m&&(d=0|m.colorCount,mt(d>0,"invalid color buffer count")),"colorType"in m&&(mt.oneOf(m.colorType,D,"invalid color type"),c=m.colorType),"colorFormat"in m&&(l=m.colorFormat,mt.oneOf(m.colorFormat,S,"invalid color format for texture"))),"depth"in m&&(u.depth=m.depth),"stencil"in m&&(u.stencil=m.stencil),"depthStencil"in m&&(u.depthStencil=m.depthStencil)}else s=1;var p;if(f)if(Array.isArray(f))for(p=[],n=0;n<f.length;++n)p[n]=f[n];else p=[f];else{p=Array(d);var b={radius:s,format:l,type:c};for(n=0;n<d;++n)p[n]=r.createCube(b)}for(u.color=Array(p.length),n=0;n<p.length;++n){var v=p[n];mt("function"==typeof v&&"textureCube"===v._reglType,"invalid cube map"),s=s||v.width,mt(v.width===s&&v.height===s,"invalid cube map shape"),u.color[n]={target:Ar,data:p[n]}}for(n=0;n<6;++n){for(var g=0;g<p.length;++g)u.color[g].target=Ar+n;n>0&&(u.depth=i[0].depth,u.stencil=i[0].stencil,u.depthStencil=i[0].depthStencil),i[n]?i[n](u):i[n]=x(u)}return Je(a,{width:s,height:s,color:p})}function o(e){var t,r=0|e;if(mt(r>0&&r<=n.maxCubeMapSize,"invalid radius for cube fbo"),r===a.width)return a;var o=a.color;for(t=0;t<o.length;++t)o[t].resize(r);for(t=0;t<6;++t)i[t].resize(r);return a.width=a.height=r,a}var i=Array(6);return a(e),Je(a,{faces:i,resize:o,_reglType:"framebufferCube",destroy:function(){i.forEach(function(e){e.destroy()})}})}function y(){yt(F).forEach(function(t){t.framebuffer=e.createFramebuffer(),v(t)})}var M={cur:null,next:null,dirty:!1,setFBO:null},S=["rgba"],w=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&w.push("srgba"),t.ext_color_buffer_half_float&&w.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&w.push("rgba32f");var D=["uint8"];t.oes_texture_half_float&&D.push("half float","float16"),t.oes_texture_float&&D.push("float","float32");var I=0,F={};return Je(M,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof h)return t}return null},create:x,createCube:g,clear:function(){yt(F).forEach(b)},restore:y})}function Pe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Yr,this.offset=0,this.stride=0,this.divisor=0}function Ce(e,t,n,r,a){for(var o=n.maxAttributes,i=new Array(o),u=0;u<o;++u)i[u]=new Pe;return{Record:Pe,scope:{},state:i}}function je(e,t,n,r){function a(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function o(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function i(n,r,a){var o=n===Ur?l:c,i=o[r];if(!i){var u=t.str(r);i=e.createShader(n),e.shaderSource(i,u),e.compileShader(i),mt.shaderError(e,i,u,n,a),o[r]=i}return i}function u(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function s(n,u){var s,f,l=i(Ur,n.fragId),c=i(Vr,n.vertId),d=n.program=e.createProgram();e.attachShader(d,l),e.attachShader(d,c),e.linkProgram(d),mt.linkError(e,d,t.str(n.fragId),t.str(n.vertId),u);var m=e.getProgramParameter(d,Wr);r.profile&&(n.stats.uniformsCount=m);var h=n.uniforms;for(s=0;s<m;++s)if(f=e.getActiveUniform(d,s))if(f.size>1)for(var p=0;p<f.size;++p){var b=f.name.replace("[0]","["+p+"]");o(h,new a(b,t.id(b),e.getUniformLocation(d,b),f))}else o(h,new a(f.name,t.id(f.name),e.getUniformLocation(d,f.name),f));var v=e.getProgramParameter(d,Hr);r.profile&&(n.stats.attributesCount=v);var x=n.attributes;for(s=0;s<v;++s)(f=e.getActiveAttrib(d,s))&&o(x,new a(f.name,t.id(f.name),e.getAttribLocation(d,f.name),f))}function f(){l={},c={};for(var e=0;e<m.length;++e)s(m[e])}var l={},c={},d={},m=[],h=0;return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return m.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},n.getMaxAttributesCount=function(){var e=0;return m.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);yt(l).forEach(t),l={},yt(c).forEach(t),c={},m.forEach(function(t){e.deleteProgram(t.program)}),m.length=0,d={},n.shaderCount=0},program:function(e,t,r){mt.command(e>=0,"missing vertex shader",r),mt.command(t>=0,"missing fragment shader",r);var a=d[t];a||(a=d[t]={});var o=a[e];return o||(o=new u(t,e),n.shaderCount++,s(o,r),a[e]=o,m.push(o)),o},restore:f,shader:i,frag:-1,vert:-1}}function Le(e,t,n,r,a,o){function i(i){var u;null===t.next?(mt(a.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=Xr):(mt(null!==t.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=t.next.colorAttachments[0].texture._texture.type,o.oes_texture_float?mt(u===Xr||u===Zr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):mt(u===Xr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var s=0,f=0,l=r.framebufferWidth,c=r.framebufferHeight,d=null;Ke(i)?d=i:i&&(mt.type(i,"object","invalid arguments to regl.read()"),s=0|i.x,f=0|i.y,mt(s>=0&&s<r.framebufferWidth,"invalid x offset for regl.read"),mt(f>=0&&f<r.framebufferHeight,"invalid y offset for regl.read"),l=0|(i.width||r.framebufferWidth-s),c=0|(i.height||r.framebufferHeight-f),d=i.data||null),d&&(u===Xr?mt(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):u===Zr&&mt(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),mt(l>0&&l+s<=r.framebufferWidth,"invalid width for read pixels"),mt(c>0&&c+f<=r.framebufferHeight,"invalid height for read pixels"),n();var m=l*c*4;return d||(u===Xr?d=new Uint8Array(m):u===Zr&&(d=d||new Float32Array(m))),mt.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),mt(d.byteLength>=m,"data buffer for regl.read() too small"),e.pixelStorei(Qr,4),e.readPixels(s,f,l,c,Gr,u,d),d}function u(e){var n;return t.setFBO({framebuffer:e.framebuffer},function(){n=i(e)}),n}function s(e){return e&&"framebuffer"in e?u(e):i(e)}return s}function Re(e){return Array.prototype.slice.call(e)}function qe(e){return Re(e).join("")}function Ne(){function e(e){for(var t=0;t<s.length;++t)if(s[t]===e)return u[t];var n="g"+i++;return u.push(n),s.push(e),n}function t(){function e(){n.push.apply(n,Re(arguments))}function t(){var e="v"+i++;return r.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,Re(arguments)),n.push(";")),e}var n=[],r=[];return Je(e,{def:t,toString:function(){return qe([r.length>0?"var "+r+";":"",qe(n)])}})}function n(){function e(e,t){r(e,t,"=",n.def(e,t),";")}var n=t(),r=t(),a=n.toString,o=r.toString;return Je(function(){n.apply(n,Re(arguments))},{def:n.def,entry:n,exit:r,save:e,set:function(t,r,a){e(t,r),n(t,r,"=",a,";")},toString:function(){return a()+o()}})}function r(){var e=qe(arguments),t=n(),r=n(),a=t.toString,o=r.toString;return Je(t,{then:function(){return t.apply(t,Re(arguments)),this},else:function(){return r.apply(r,Re(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),qe(["if(",e,"){",a(),"}",t])}})}function a(e,t){function r(){var e="a"+a.length;return a.push(e),e}var a=[];t=t||0;for(var o=0;o<t;++o)r();var i=n(),u=i.toString;return l[e]=Je(i,{arg:r,toString:function(){return qe(["function(",a.join(),"){",u(),"}"])}})}function o(){var e=['"use strict";',f,"return {"];Object.keys(l).forEach(function(t){e.push('"',t,'":',l[t].toString(),",")}),e.push("}");var t=qe(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,u.concat(t)).apply(null,s)}var i=0,u=[],s=[],f=t(),l={};return{global:f,link:e,block:t,proc:a,scope:n,cond:r,compile:o}}function Be(e){return Array.isArray(e)||Ke(e)||Q(e)}function Ye(e){return e.sort(function(e,t){return e===za?-1:t===za?1:e<t?-1:1})}function Ue(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function Ve(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function We(e){return new Ue(!1,!1,!1,e)}function He(e,t){var n=e.type;if(n===ta){var r=e.data.length;return new Ue(!0,r>=1,r>=2,t)}if(n===oa){var a=e.data;return new Ue(a.thisDep,a.contextDep,a.propDep,t)}return new Ue(n===aa,n===ra,n===na,t)}function Ge(e,t,n,r,a,o,i,u,s,f,l,c,d,m,h){function p(e){return e.replace(".","_")}function b(e,t,n){var r=p(e);te.push(e),ee[r]=J[r]=!!n,ne[r]=t}function v(e,t,n){var r=p(e);te.push(e),Array.isArray(n)?(J[r]=n.slice(),ee[r]=n.slice()):J[r]=ee[r]=n,re[r]=t}function x(){var e=Ne(),n=e.link,r=e.global;e.id=ie++,e.batchId="0";var a=n(ae),o=e.shared={props:"a0"};Object.keys(ae).forEach(function(e){o[e]=r.def(a,".",e)}),mt.optional(function(){e.CHECK=n(mt),e.commandStr=mt.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},oe.invalidBlendCombinations=Yo});var i=e.next={},u=e.current={};Object.keys(re).forEach(function(e){Array.isArray(J[e])&&(i[e]=r.def(o.next,".",e),u[e]=r.def(o.current,".",e))});var s=e.constants={};Object.keys(oe).forEach(function(e){s[e]=r.def(JSON.stringify(oe[e]))}),e.invoke=function(t,r){switch(r.type){case ta:var a=["this",o.context,o.props,e.batchId];return t.def(n(r.data),".call(",a.slice(0,Math.max(r.data.length+1,4)),")");case na:return t.def(o.props,r.data);case ra:return t.def(o.context,r.data);case aa:return t.def("this",r.data);case oa:return r.data.append(e,t),r.data.ref}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var r=t.id(e);if(r in l)return l[r];var a=f.scope[r];return a||(a=f.scope[r]=new X),l[r]=n(a)},e}function g(e){var t,n=e.static,r=e.dynamic;if(Oa in n){var a=!!n[Oa];t=We(function(e,t){return a}),t.enable=a}else if(Oa in r){var o=r[Oa];t=He(o,function(e,t){return e.invoke(t,o)})}return t}function y(e,t){var n=e.static,r=e.dynamic;if(Pa in n){var a=n[Pa];return a?(a=u.getFramebuffer(a),mt.command(a,"invalid framebuffer object"),We(function(e,t){var n=e.link(a),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+Ya,n+".width"),t.set(o,"."+Ua,n+".height"),n})):We(function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Ya,r+"."+Ha),t.set(r,"."+Ua,r+"."+Ga),"null"})}if(Pa in r){var o=r[Pa];return He(o,function(e,t){var n=e.invoke(t,o),r=e.shared,a=r.framebuffer,i=t.def(a,".getFramebuffer(",n,")");mt.optional(function(){e.assert(t,"!"+n+"||"+i,"invalid framebuffer object")}),t.set(a,".next",i);var u=r.context;return t.set(u,"."+Ya,i+"?"+i+".width:"+u+"."+Ha),t.set(u,"."+Ua,i+"?"+i+".height:"+u+"."+Ga),i})}return null}function M(e,t,n){function r(e){if(e in a){var r=a[e];mt.commandType(r,"object","invalid "+e,n.commandStr);var i,u,s=!0,f=0|r.x,l=0|r.y;return"width"in r?(i=0|r.width,mt.command(i>=0,"invalid "+e,n.commandStr)):s=!1,"height"in r?(u=0|r.height,mt.command(u>=0,"invalid "+e,n.commandStr)):s=!1,new Ue(!s&&t&&t.thisDep,!s&&t&&t.contextDep,!s&&t&&t.propDep,function(e,t){var n=e.shared.context,a=i;"width"in r||(a=t.def(n,".",Ya,"-",f));var o=u;return"height"in r||(o=t.def(n,".",Ua,"-",l)),[f,l,a,o]})}if(e in o){var c=o[e],d=He(c,function(t,n){var r=t.invoke(n,c);mt.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)});var a=t.shared.context,o=n.def(r,".x|0"),i=n.def(r,".y|0"),u=n.def('"width" in ',r,"?",r,".width|0:","(",a,".",Ya,"-",o,")"),s=n.def('"height" in ',r,"?",r,".height|0:","(",a,".",Ua,"-",i,")");return mt.optional(function(){t.assert(n,u+">=0&&"+s+">=0","invalid "+e)}),[o,i,u,s]});return t&&(d.thisDep=d.thisDep||t.thisDep,d.contextDep=d.contextDep||t.contextDep,d.propDep=d.propDep||t.propDep),d}return t?new Ue(t.thisDep,t.contextDep,t.propDep,function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Ya),t.def(n,".",Ua)]}):null}var a=e.static,o=e.dynamic,i=r(za);if(i){var u=i;i=new Ue(i.thisDep,i.contextDep,i.propDep,function(e,t){var n=u.append(e,t),r=e.shared.context;return t.set(r,"."+Va,n[2]),t.set(r,"."+Wa,n[3]),n})}return{viewport:i,scissor_box:r(Ta)}}function S(e){function n(e){if(e in a){var n=t.id(a[e]);mt.optional(function(){l.shader(Wo[e],n,mt.guessCommand())});var r=We(function(){return n});return r.id=n,r}if(e in o){var i=o[e];return He(i,function(t,n){var r=t.invoke(n,i),a=n.def(t.shared.strings,".id(",r,")");return mt.optional(function(){n(t.shared.shader,".shader(",Wo[e],",",a,",",t.command,");")}),a})}return null}var r,a=e.static,o=e.dynamic,i=n(ja),u=n(Ca),s=null;return Ve(i)&&Ve(u)?(s=l.program(u.id,i.id),r=We(function(e,t){return e.link(s)})):r=new Ue(i&&i.thisDep||u&&u.thisDep,i&&i.contextDep||u&&u.contextDep,i&&i.propDep||u&&u.propDep,function(e,t){var n,r=e.shared.shader;n=i?i.append(e,t):t.def(r,".",ja);var a;a=u?u.append(e,t):t.def(r,".",Ca);var o=r+".program("+a+","+n;return mt.optional(function(){o+=","+e.command}),t.def(o+")")}),{frag:i,vert:u,progVar:r,program:s}}function w(e,t){function n(e,n){if(e in r){var o=0|r[e];return mt.command(!n||o>=0,"invalid "+e,t.commandStr),We(function(e,t){return n&&(e.OFFSET=o),o})}if(e in a){var u=a[e];return He(u,function(t,r){var a=t.invoke(r,u);return n&&(t.OFFSET=a,mt.optional(function(){t.assert(r,a+">=0","invalid "+e)})),a})}return n&&i?We(function(e,t){return e.OFFSET="0",0}):null}var r=e.static,a=e.dynamic,i=function(){if(La in r){var e=r[La];Be(e)?e=o.getElements(o.create(e,!0)):e&&(e=o.getElements(e),mt.command(e,"invalid elements",t.commandStr));var n=We(function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null});return n.value=e,n}if(La in a){var i=a[La];return He(i,function(e,t){var n=e.shared,r=n.isBufferArgs,a=n.elements,o=e.invoke(t,i),u=t.def("null"),s=t.def(r,"(",o,")"),f=e.cond(s).then(u,"=",a,".createStream(",o,");").else(u,"=",a,".getElements(",o,");");return mt.optional(function(){e.assert(f.else,"!"+o+"||"+u,"invalid elements")}),t.entry(f),t.exit(e.cond(s).then(a,".destroyStream(",u,");")),e.ELEMENTS=u,u})}return null}(),u=n(Na,!0);return{elements:i,primitive:function(){if(Ra in r){var e=r[Ra];return mt.commandParameter(e,Nt,"invalid primitve",t.commandStr),We(function(t,n){return Nt[e]})}if(Ra in a){var n=a[Ra];return He(n,function(e,t){var r=e.constants.primTypes,a=e.invoke(t,n);return mt.optional(function(){e.assert(t,a+" in "+r,"invalid primitive, must be one of "+Object.keys(Nt))}),t.def(r,"[",a,"]")})}return i?Ve(i)?We(i.value?function(e,t){return t.def(e.ELEMENTS,".primType")}:function(){return Fo}):new Ue(i.thisDep,i.contextDep,i.propDep,function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",Fo)}):null}(),count:function(){if(qa in r){var e=0|r[qa];return mt.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),We(function(){return e})}if(qa in a){var n=a[qa];return He(n,function(e,t){var r=e.invoke(t,n);return mt.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")}),r})}if(i){if(Ve(i)){if(i)return u?new Ue(u.thisDep,u.contextDep,u.propDep,function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return mt.optional(function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")}),n}):We(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var o=We(function(){return-1});return mt.optional(function(){o.MISSING=!0}),o}var s=new Ue(i.thisDep||u.thisDep,i.contextDep||u.contextDep,i.propDep||u.propDep,function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")});return mt.optional(function(){s.DYNAMIC=!0}),s}return null}(),instances:n(Ba,!1),offset:u}}function D(e,t){var n=e.static,a=e.dynamic,o={};return te.forEach(function(e){function i(t,r){if(e in n){var i=t(n[e]);o[u]=We(function(){return i})}else if(e in a){var s=a[e];o[u]=He(s,function(e,t){return r(e,t,e.invoke(t,s))})}}var u=p(e);switch(e){case ba:case ua:case ia:case Ia:case ca:case ka:case ya:case Sa:case wa:case ha:return i(function(n){return mt.commandType(n,"boolean",e,t.commandStr),n},function(t,n,r){return mt.optional(function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)}),r});case da:return i(function(n){return mt.commandParameter(n,Uo,"invalid "+e,t.commandStr),Uo[n]},function(t,n,r){var a=t.constants.compareFuncs;return mt.optional(function(){t.assert(n,r+" in "+a,"invalid "+e+", must be one of "+Object.keys(Uo))}),n.def(a,"[",r,"]")});case ma:return i(function(e){return mt.command(pe(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e},function(e,t,n){return mt.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")}),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]});case la:return i(function(e){mt.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,a="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return mt.commandParameter(n,Bo,u+".srcRGB",t.commandStr),mt.commandParameter(r,Bo,u+".srcAlpha",t.commandStr),mt.commandParameter(a,Bo,u+".dstRGB",t.commandStr),mt.commandParameter(o,Bo,u+".dstAlpha",t.commandStr),mt.command(-1===Yo.indexOf(n+", "+a),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+a+")",t.commandStr),[Bo[n],Bo[a],Bo[r],Bo[o]]},function(t,n,r){function a(a,i){var u=n.def('"',a,i,'" in ',r,"?",r,".",a,i,":",r,".",a);return mt.optional(function(){t.assert(n,u+" in "+o,"invalid "+e+"."+a+i+", must be one of "+Object.keys(Bo))}),u}var o=t.constants.blendFuncs;mt.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")});var i=a("src","RGB"),u=a("dst","RGB");mt.optional(function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+i+'+", "+'+u+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var s=n.def(o,"[",i,"]"),f=n.def(o,"[",a("src","Alpha"),"]");return[s,n.def(o,"[",u,"]"),f,n.def(o,"[",a("dst","Alpha"),"]")]});case fa:return i(function(n){return"string"==typeof n?(mt.commandParameter(n,Q,"invalid "+e,t.commandStr),[Q[n],Q[n]]):"object"==typeof n?(mt.commandParameter(n.rgb,Q,e+".rgb",t.commandStr),mt.commandParameter(n.alpha,Q,e+".alpha",t.commandStr),[Q[n.rgb],Q[n.alpha]]):void mt.commandRaise("invalid blend.equation",t.commandStr)},function(t,n,r){var a=t.constants.blendEquations,o=n.def(),i=n.def(),u=t.cond("typeof ",r,'==="string"');return mt.optional(function(){function n(e,n,r){t.assert(e,r+" in "+a,"invalid "+n+", must be one of "+Object.keys(Q))}n(u.then,e,r),t.assert(u.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(u.else,e+".rgb",r+".rgb"),n(u.else,e+".alpha",r+".alpha")}),u.then(o,"=",i,"=",a,"[",r,"];"),u.else(o,"=",a,"[",r,".rgb];",i,"=",a,"[",r,".alpha];"),n(u),[o,i]});case sa:return i(function(e){return mt.command(pe(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),Z(4,function(t){return+e[t]})},function(e,t,n){return mt.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")}),Z(4,function(e){return t.def("+",n,"[",e,"]")})});case Fa:return i(function(e){return mt.commandType(e,"number",u,t.commandStr),0|e},function(e,t,n){return mt.optional(function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")}),t.def(n,"|0")});case Aa:return i(function(n){mt.commandType(n,"object",u,t.commandStr);var r=n.cmp||"keep",a=n.ref||0,o="mask"in n?n.mask:-1;return mt.commandParameter(r,Uo,e+".cmp",t.commandStr),mt.commandType(a,"number",e+".ref",t.commandStr),mt.commandType(o,"number",e+".mask",t.commandStr),[Uo[r],a,o]},function(e,t,n){var r=e.constants.compareFuncs;return mt.optional(function(){function a(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(n+"&&typeof ",n,'==="object"'),a('!("cmp" in ',n,")||(",n,".cmp in ",r,")")}),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Po),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]});case _a:case Ea:return i(function(n){mt.commandType(n,"object",u,t.commandStr);var r=n.fail||"keep",a=n.zfail||"keep",o=n.zpass||"keep";return mt.commandParameter(r,Vo,e+".fail",t.commandStr),mt.commandParameter(a,Vo,e+".zfail",t.commandStr),mt.commandParameter(o,Vo,e+".zpass",t.commandStr),[e===Ea?_o:Ao,Vo[r],Vo[a],Vo[o]]},function(t,n,r){function a(a){return mt.optional(function(){t.assert(n,'!("'+a+'" in '+r+")||("+r+"."+a+" in "+o+")","invalid "+e+"."+a+", must be one of "+Object.keys(Vo))}),n.def('"',a,'" in ',r,"?",o,"[",r,".",a,"]:",Po)}var o=t.constants.stencilOps;return mt.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[e===Ea?_o:Ao,a("fail"),a("zfail"),a("zpass")]});case Ma:return i(function(e){mt.commandType(e,"object",u,t.commandStr);var n=0|e.factor,r=0|e.units;return mt.commandType(n,"number",u+".factor",t.commandStr),mt.commandType(r,"number",u+".units",t.commandStr),[n,r]},function(t,n,r){return mt.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[n.def(r,".factor|0"),n.def(r,".units|0")]});case va:return i(function(e){var n=0;return"front"===e?n=Ao:"back"===e&&(n=_o),mt.command(!!n,u,t.commandStr),n},function(e,t,n){return mt.optional(function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")}),t.def(n,'==="front"?',Ao,":",_o)});case ga:return i(function(e){return mt.command("number"==typeof e&&e>=r.lineWidthDims[0]&&e<=r.lineWidthDims[1],"invalid line width, must positive number between "+r.lineWidthDims[0]+" and "+r.lineWidthDims[1],t.commandStr),e},function(e,t,n){return mt.optional(function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+r.lineWidthDims[0]+"&&"+n+"<="+r.lineWidthDims[1],"invalid line width")}),n});case xa:return i(function(e){return mt.commandParameter(e,Ho,u,t.commandStr),Ho[e]},function(e,t,n){return mt.optional(function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(n+'==="cw"?'+Eo+":"+ko)});case pa:return i(function(e){return mt.command(pe(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map(function(e){return!!e})},function(e,t,n){return mt.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")}),Z(4,function(e){return"!!"+n+"["+e+"]"})});case Da:return i(function(e){mt.command("object"==typeof e&&e,u,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return mt.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]},function(e,t,n){return mt.optional(function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")}),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]})}}),o}function I(e,t){var n=e.static,r=e.dynamic,a={};return Object.keys(n).forEach(function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=We(function(){return o});else if("function"==typeof o){var i=o._reglType;"texture2d"===i||"textureCube"===i?r=We(function(e){return e.link(o)}):"framebuffer"===i||"framebufferCube"===i?(mt.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=We(function(e){return e.link(o.color[0])})):mt.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else pe(o)?r=We(function(t){return t.global.def("[",Z(o.length,function(n){return mt.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]}),"]")}):mt.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,a[e]=r}),Object.keys(r).forEach(function(e){var t=r[e];a[e]=He(t,function(e,n){return e.invoke(n,t)})}),a}function F(e,n){var r=e.static,o=e.dynamic,i={};return Object.keys(r).forEach(function(e){var o=r[e],u=t.id(e),s=new X;if(Be(o))s.state=Jr,s.buffer=a.getBuffer(a.create(o,Qa,!1,!0)),s.type=0;else{var f=a.getBuffer(o);if(f)s.state=Jr,s.buffer=f,s.type=0;else if(mt.command("object"==typeof o&&o,"invalid data for attribute "+e,n.commandStr),o.constant){var l=o.constant;s.buffer="null",s.state=ea,"number"==typeof l?s.x=l:(mt.command(pe(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e,n.commandStr),$r.forEach(function(e,t){t<l.length&&(s[e]=l[t])}))}else{f=Be(o.buffer)?a.getBuffer(a.create(o.buffer,Qa,!1,!0)):a.getBuffer(o.buffer),mt.command(!!f,'missing buffer for attribute "'+e+'"',n.commandStr);var c=0|o.offset;mt.command(c>=0,'invalid offset for attribute "'+e+'"',n.commandStr);var d=0|o.stride;mt.command(d>=0&&d<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',n.commandStr);var m=0|o.size;mt.command(!("size"in o)||m>0&&m<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',n.commandStr);var h=!!o.normalized,p=0;"type"in o&&(mt.commandParameter(o.type,Tt,"invalid type for attribute "+e,n.commandStr),p=Tt[o.type]);var b=0|o.divisor;"divisor"in o&&(mt.command(0===b||$,'cannot specify divisor for attribute "'+e+'", instancing not supported',n.commandStr),mt.command(b>=0,'invalid divisor for attribute "'+e+'"',n.commandStr)),mt.optional(function(){var t=n.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(o).forEach(function(n){mt.command(r.indexOf(n)>=0,'unknown parameter "'+n+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",t)})}),s.buffer=f,s.state=Jr,s.size=m,s.normalized=h,s.type=p||f.dtype,s.offset=c,s.stride=d,s.divisor=b}}i[e]=We(function(e,t){var n=e.attribCache;if(u in n)return n[u];var r={isStream:!1};return Object.keys(s).forEach(function(e){r[e]=s[e]}),s.buffer&&(r.buffer=e.link(s.buffer),r.type=r.type||r.buffer+".dtype"),n[u]=r,r})}),Object.keys(o).forEach(function(e){function t(t,r){function a(e){r(f[e],"=",o,".",e,"|0;")}var o=t.invoke(r,n),i=t.shared,u=i.isBufferArgs,s=i.buffer;mt.optional(function(){t.assert(r,o+"&&(typeof "+o+'==="object"||typeof '+o+'==="function")&&('+u+"("+o+")||"+s+".getBuffer("+o+")||"+s+".getBuffer("+o+".buffer)||"+u+"("+o+'.buffer)||("constant" in '+o+"&&(typeof "+o+'.constant==="number"||'+i.isArrayLike+"("+o+".constant))))",'invalid dynamic attribute "'+e+'"')});var f={isStream:r.def(!1)},l=new X;l.state=Jr,Object.keys(l).forEach(function(e){f[e]=r.def(""+l[e])});var c=f.buffer,d=f.type;return r("if(",u,"(",o,")){",f.isStream,"=true;",c,"=",s,".createStream(",Qa,",",o,");",d,"=",c,".dtype;","}else{",c,"=",s,".getBuffer(",o,");","if(",c,"){",d,"=",c,".dtype;",'}else if("constant" in ',o,"){",f.state,"=",ea,";","if(typeof "+o+'.constant === "number"){',f[$r[0]],"=",o,".constant;",$r.slice(1).map(function(e){return f[e]}).join("="),"=0;","}else{",$r.map(function(e,t){return f[e]+"="+o+".constant.length>="+t+"?"+o+".constant["+t+"]:0;"}).join(""),"}}else{","if(",u,"(",o,".buffer)){",c,"=",s,".createStream(",Qa,",",o,".buffer);","}else{",c,"=",s,".getBuffer(",o,".buffer);","}",d,'="type" in ',o,"?",i.glTypes,"[",o,".type]:",c,".dtype;",f.normalized,"=!!",o,".normalized;"),a("size"),a("offset"),a("stride"),a("divisor"),r("}}"),r.exit("if(",f.isStream,"){",s,".destroyStream(",c,");","}"),f}var n=o[e];i[e]=He(n,t)}),i}function A(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n=t[e];r[e]=We(function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)})}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=He(t,function(e,n){return e.invoke(n,t)})}),r}function _(e,t,n,r,a){function o(e){var t=f[e];t&&(c[e]=t)}var i=e.static,u=e.dynamic;mt.optional(function(){function e(e){Object.keys(e).forEach(function(e){mt.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',a.commandStr)})}var t=[Pa,Ca,ja,La,Ra,Na,qa,Ba,Oa].concat(te);e(i),e(u)});var s=y(e,a),f=M(e,s,a),l=w(e,a),c=D(e,a),d=S(e,a);o(za),o(p(Ta));var m=Object.keys(c).length>0,h={framebuffer:s,draw:l,shader:d,state:c,dirty:m};return h.profile=g(e,a),h.uniforms=I(n,a),h.attributes=F(t,a),h.context=A(r,a),h}function E(e,t,n){var r=e.shared,a=r.context,o=e.scope();Object.keys(n).forEach(function(r){t.save(a,"."+r);var i=n[r];o(a,".",r,"=",i.append(e,t),";")}),t(o)}function k(e,t,n,r){var a,o=e.shared,i=o.gl,u=o.framebuffer;K&&(a=t.def(o.extensions,".webgl_draw_buffers"));var s,f=e.constants,l=f.drawBuffer,c=f.backBuffer;s=n?n.append(e,t):t.def(u,".next"),r||t("if(",s,"!==",u,".cur){"),t("if(",s,"){",i,".bindFramebuffer(",qo,",",s,".framebuffer);"),K&&t(a,".drawBuffersWEBGL(",l,"[",s,".colorAttachments.length]);"),t("}else{",i,".bindFramebuffer(",qo,",null);"),K&&t(a,".drawBuffersWEBGL(",c,");"),t("}",u,".cur=",s,";"),r||t("}")}function T(e,t,n){var r=e.shared,a=r.gl,o=e.current,i=e.next,u=r.current,s=r.next,f=e.cond(u,".dirty");te.forEach(function(t){var r=p(t);if(!(r in n.state)){var l,c;if(r in i){l=i[r],c=o[r];var d=Z(J[r].length,function(e){return f.def(l,"[",e,"]")});f(e.cond(d.map(function(e,t){return e+"!=="+c+"["+t+"]"}).join("||")).then(a,".",re[r],"(",d,");",d.map(function(e,t){return c+"["+t+"]="+e}).join(";"),";"))}else{l=f.def(s,".",r);var m=e.cond(l,"!==",u,".",r);f(m),r in ne?m(e.cond(l).then(a,".enable(",ne[r],");").else(a,".disable(",ne[r],");"),u,".",r,"=",l,";"):m(a,".",re[r],"(",l,");",u,".",r,"=",l,";")}}}),0===Object.keys(n.state).length&&f(u,".dirty=false;"),t(f)}function z(e,t,n,r){var a=e.shared,o=e.current,i=a.current,u=a.gl;Ye(Object.keys(n)).forEach(function(a){var s=n[a];if(!r||r(s)){var f=s.append(e,t);if(ne[a]){var l=ne[a];Ve(s)?f?t(u,".enable(",l,");"):t(u,".disable(",l,");"):t(e.cond(f).then(u,".enable(",l,");").else(u,".disable(",l,");")),t(i,".",a,"=",f,";")}else if(pe(f)){var c=o[a];t(u,".",re[a],"(",f,");",f.map(function(e,t){return c+"["+t+"]="+e}).join(";"),";")}else t(u,".",re[a],"(",f,");",i,".",a,"=",f,";")}})}function O(e,t){$&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function P(e,t,n,r,a){function o(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function i(e){f=t.def(),e(f,"=",o(),";"),"string"==typeof a?e(h,".count+=",a,";"):e(h,".count++;"),m&&(r?(l=t.def(),e(l,"=",b,".getNumPendingQueries();")):e(b,".beginQuery(",h,");"))}function u(e){e(h,".cpuTime+=",o(),"-",f,";"),m&&(r?e(b,".pushScopeStats(",l,",",b,".getNumPendingQueries(),",h,");"):e(b,".endQuery();"))}function s(e){var n=t.def(p,".profile");t(p,".profile=",e,";"),t.exit(p,".profile=",n,";")}var f,l,c,d=e.shared,h=e.stats,p=d.current,b=d.timer,v=n.profile;if(v){if(Ve(v))return void(v.enable?(i(t),u(t.exit),s("true")):s("false"));c=v.append(e,t),s(c)}else c=t.def(p,".profile");var x=e.block();i(x),t("if(",c,"){",x,"}");var g=e.block();u(g),t.exit("if(",c,"){",g,"}")}function C(e,t,n,r,a){function o(e){switch(e){case fo:case ho:case xo:return 2;case lo:case po:case go:return 3;case co:case bo:case yo:return 4;default:return 1}}function i(n,r,a){function o(){t("if(!",l,".buffer){",s,".enableVertexAttribArray(",f,");}");var n,o=a.type;if(n=a.size?t.def(a.size,"||",r):r,t("if(",l,".type!==",o,"||",l,".size!==",n,"||",h.map(function(e){return l+"."+e+"!=="+a[e]}).join("||"),"){",s,".bindBuffer(",Qa,",",d,".buffer);",s,".vertexAttribPointer(",[f,n,o,a.normalized,a.stride,a.offset],");",l,".type=",o,";",l,".size=",n,";",h.map(function(e){return l+"."+e+"="+a[e]+";"}).join(""),"}"),$){var i=a.divisor;t("if(",l,".divisor!==",i,"){",e.instancing,".vertexAttribDivisorANGLE(",[f,i],");",l,".divisor=",i,";}")}}function i(){t("if(",l,".buffer){",s,".disableVertexAttribArray(",f,");","}if(",$r.map(function(e,t){return l+"."+e+"!=="+m[t]}).join("||"),"){",s,".vertexAttrib4f(",f,",",m,");",$r.map(function(e,t){return l+"."+e+"="+m[t]+";"}).join(""),"}")}var s=u.gl,f=t.def(n,".location"),l=t.def(u.attributes,"[",f,"]"),c=a.state,d=a.buffer,m=[a.x,a.y,a.z,a.w],h=["buffer","normalized","offset","stride"];c===Jr?o():c===ea?i():(t("if(",c,"===",Jr,"){"),o(),t("}else{"),i(),t("}"))}var u=e.shared;r.forEach(function(r){var u,s=r.name,f=n.attributes[s];if(f){if(!a(f))return;u=f.append(e,t)}else{if(!a(Go))return;var l=e.scopeAttrib(s);mt.optional(function(){e.assert(t,l+".state","missing attribute "+s)}),u={},Object.keys(new X).forEach(function(e){u[e]=t.def(l,".",e)})}i(e.link(r),o(r.info.type),u)})}function j(e,n,r,a,o){for(var i,u=e.shared,s=u.gl,f=0;f<a.length;++f){var l,c=a[f],d=c.name,m=c.info.type,h=r.uniforms[d],p=e.link(c),b=p+".location";if(h){if(!o(h))continue;if(Ve(h)){var v=h.value;if(mt.command(null!==v&&void 0!==v,'missing uniform "'+d+'"',e.commandStr),m===Do||m===Io){mt.command("function"==typeof v&&(m===Do&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||m===Io&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+d,e.commandStr);var x=e.link(v._texture||v.color[0]._texture);n(s,".uniform1i(",b,",",x+".bind());"),n.exit(x,".unbind();")}else if(m===Mo||m===So||m===wo){mt.optional(function(){mt.command(pe(v),"invalid matrix for uniform "+d,e.commandStr),mt.command(m===Mo&&4===v.length||m===So&&9===v.length||m===wo&&16===v.length,"invalid length for matrix uniform "+d,e.commandStr)});var g=e.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),y=2;m===So?y=3:m===wo&&(y=4),n(s,".uniformMatrix",y,"fv(",b,",false,",g,");")}else{switch(m){case so:mt.commandType(v,"number","uniform "+d,e.commandStr),i="1f";break;case fo:mt.command(pe(v)&&2===v.length,"uniform "+d,e.commandStr),i="2f";break;case lo:mt.command(pe(v)&&3===v.length,"uniform "+d,e.commandStr),i="3f";break;case co:mt.command(pe(v)&&4===v.length,"uniform "+d,e.commandStr),i="4f";break;case vo:mt.commandType(v,"boolean","uniform "+d,e.commandStr),i="1i";break;case mo:mt.commandType(v,"number","uniform "+d,e.commandStr),i="1i";break;case xo:case ho:mt.command(pe(v)&&2===v.length,"uniform "+d,e.commandStr),i="2i";break;case go:case po:mt.command(pe(v)&&3===v.length,"uniform "+d,e.commandStr),i="3i";break;case yo:case bo:mt.command(pe(v)&&4===v.length,"uniform "+d,e.commandStr),i="4i"}n(s,".uniform",i,"(",b,",",pe(v)?Array.prototype.slice.call(v):v,");")}continue}l=h.append(e,n)}else{if(!o(Go))continue;l=n.def(u.uniforms,"[",t.id(d),"]")}m===Do?n("if(",l,"&&",l,'._reglType==="framebuffer"){',l,"=",l,".color[0];","}"):m===Io&&n("if(",l,"&&",l,'._reglType==="framebufferCube"){',l,"=",l,".color[0];","}"),mt.optional(function(){function t(t,r){e.assert(n,t,'bad data or missing for uniform "'+d+'".  '+r)}function r(e){t("typeof "+l+'==="'+e+'"',"invalid type, expected "+e)}function a(n,r){t(u.isArrayLike+"("+l+")&&"+l+".length==="+n,"invalid vector, should have length "+n,e.commandStr)}function o(n){t("typeof "+l+'==="function"&&'+l+'._reglType==="texture'+(n===$a?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(m){case mo:r("number");break;case ho:a(2,"number");break;case po:a(3,"number");break;case bo:a(4,"number");break;case so:r("number");break;case fo:a(2,"number");break;case lo:a(3,"number");break;case co:a(4,"number");break;case vo:r("boolean");break;case xo:a(2,"boolean");break;case go:a(3,"boolean");break;case yo:a(4,"boolean");break;case Mo:a(4,"number");break;case So:a(9,"number");break;case wo:a(16,"number");break;case Do:o($a);break;case Io:o(Ka)}});var M=1;switch(m){case Do:case Io:var S=n.def(l,"._texture");n(s,".uniform1i(",b,",",S,".bind());"),n.exit(S,".unbind();");continue;case mo:case vo:i="1i";break;case ho:case xo:i="2i",M=2;break;case po:case go:i="3i",M=3;break;case bo:case yo:i="4i",M=4;break;case so:i="1f";break;case fo:i="2f",M=2;break;case lo:i="3f",M=3;break;case co:i="4f",M=4;break;case Mo:i="Matrix2fv";break;case So:i="Matrix3fv";break;case wo:i="Matrix4fv"}if(n(s,".uniform",i,"(",b,","),"M"===i.charAt(0)){var w=Math.pow(m-Mo+2,2),D=e.global.def("new Float32Array(",w,")");n("false,(Array.isArray(",l,")||",l," instanceof Float32Array)?",l,":(",Z(w,function(e){return D+"["+e+"]="+l+"["+e+"]"}),",",D,")")}else n(M>1?Z(M,function(e){return l+"["+e+"]"}):l);n(");")}}function L(e,t,n,r){function a(a){var o=l[a];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(f,".",a)}function o(){function e(){n(b,".drawElementsInstancedANGLE(",[d,h,v,m+"<<(("+v+"-"+Kr+")>>1)",p],");")}function t(){n(b,".drawArraysInstancedANGLE(",[d,m,h,p],");")}c?x?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}function i(){function e(){n(s+".drawElements("+[d,h,v,m+"<<(("+v+"-"+Kr+")>>1)"]+");")}function t(){n(s+".drawArrays("+[d,m,h]+");")}c?x?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}var u=e.shared,s=u.gl,f=u.draw,l=r.draw,c=function(){var a,o=l.elements,i=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(i=n),a=o.append(e,i)):a=i.def(f,".",La),a&&i("if("+a+")"+s+".bindBuffer("+Za+","+a+".buffer.buffer);"),a}(),d=a(Ra),m=a(Na),h=function(){var a,o=l.count,i=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(i=n),a=o.append(e,i),mt.optional(function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(i,a+">=0","missing vertex count")})):(a=i.def(f,".",qa),mt.optional(function(){e.assert(i,a+">=0","missing vertex count")})),a}();if("number"==typeof h){if(0===h)return}else n("if(",h,"){"),n.exit("}");var p,b;$&&(p=a(Ba),b=e.instancing);var v=c+".type",x=l.elements&&Ve(l.elements);$&&("number"!=typeof p||p>=0)?"string"==typeof p?(n("if(",p,">0){"),o(),n("}else if(",p,"<0){"),i(),n("}")):o():i()}function R(e,t,n,r,a){var o=x(),i=o.proc("body",a);return mt.optional(function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)}),$&&(o.instancing=i.def(o.shared.extensions,".angle_instanced_arrays")),e(o,i,n,r),o.compile().body}function q(e,t,n,r){O(e,t),C(e,t,n,r.attributes,function(){return!0}),j(e,t,n,r.uniforms,function(){return!0}),L(e,t,t,n)}function N(e,t){var n=e.proc("draw",1);O(e,n),E(e,n,t.context),k(e,n,t.framebuffer),T(e,n,t),z(e,n,t.state),P(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)q(e,n,t,t.shader.program);else{var a=e.global.def("{}"),o=n.def(r,".id"),i=n.def(a,"[",o,"]");n(e.cond(i).then(i,".call(this,a0);").else(i,"=",a,"[",o,"]=",e.link(function(n){return R(q,e,t,n,1)}),"(",r,");",i,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}function B(e,t,n,r){function a(){return!0}e.batchId="a1",O(e,t),C(e,t,n,r.attributes,a),j(e,t,n,r.uniforms,a),L(e,t,t,n)}function Y(e,t,n,r){function a(e){return e.contextDep&&i||e.propDep}function o(e){return!a(e)}O(e,t);var i=n.contextDep,u=t.def(),s=t.def();e.shared.props=s,e.batchId=u;var f=e.scope(),l=e.scope();if(t(f.entry,"for(",u,"=0;",u,"<","a1",";++",u,"){",s,"=","a0","[",u,"];",l,"}",f.exit),n.needsContext&&E(e,l,n.context),n.needsFramebuffer&&k(e,l,n.framebuffer),z(e,l,n.state,a),n.profile&&a(n.profile)&&P(e,l,n,!1,!0),r)C(e,f,n,r.attributes,o),C(e,l,n,r.attributes,a),j(e,f,n,r.uniforms,o),j(e,l,n,r.uniforms,a),L(e,f,l,n);else{var c=e.global.def("{}"),d=n.shader.progVar.append(e,l),m=l.def(d,".id"),h=l.def(c,"[",m,"]");l(e.shared.gl,".useProgram(",d,".program);","if(!",h,"){",h,"=",c,"[",m,"]=",e.link(function(t){return R(B,e,n,t,2)}),"(",d,");}",h,".call(this,a0[",u,"],",u,");")}}function U(e,t){function n(e){return e.contextDep&&a||e.propDep}var r=e.proc("batch",2);e.batchId="0",O(e,r);var a=!1,o=!0;Object.keys(t.context).forEach(function(e){a=a||t.context[e].propDep}),a||(E(e,r,t.context),o=!1);var i=t.framebuffer,u=!1;i?(i.propDep?a=u=!0:i.contextDep&&a&&(u=!0),u||k(e,r,i)):k(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(a=!0),T(e,r,t),z(e,r,t.state,function(e){return!n(e)}),t.profile&&n(t.profile)||P(e,r,t,!1,"a1"),t.contextDep=a,t.needsContext=o,t.needsFramebuffer=u;var s=t.shader.progVar;if(s.contextDep&&a||s.propDep)Y(e,r,t,null);else{var f=s.append(e,r);if(r(e.shared.gl,".useProgram(",f,".program);"),t.shader.program)Y(e,r,t,t.shader.program);else{var l=e.global.def("{}"),c=r.def(f,".id"),d=r.def(l,"[",c,"]");r(e.cond(d).then(d,".call(this,a0,a1);").else(d,"=",l,"[",c,"]=",e.link(function(n){return R(Y,e,t,n,2)}),"(",f,");",d,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}function V(e,n){function r(t){var r=n.shader[t];r&&a.set(o.shader,"."+t,r.append(e,a))}var a=e.proc("scope",3);e.batchId="a2";var o=e.shared,i=o.current;E(e,a,n.context),n.framebuffer&&n.framebuffer.append(e,a),Ye(Object.keys(n.state)).forEach(function(t){var r=n.state[t],i=r.append(e,a);pe(i)?i.forEach(function(n,r){a.set(e.next[t],"["+r+"]",n)}):a.set(o.next,"."+t,i)}),P(e,a,n,!0,!0),[La,Na,qa,Ba,Ra].forEach(function(t){var r=n.draw[t];r&&a.set(o.draw,"."+t,""+r.append(e,a))}),Object.keys(n.uniforms).forEach(function(r){a.set(o.uniforms,"["+t.id(r)+"]",n.uniforms[r].append(e,a))}),Object.keys(n.attributes).forEach(function(t){var r=n.attributes[t].append(e,a),o=e.scopeAttrib(t);Object.keys(new X).forEach(function(e){a.set(o,"."+e,r[e])})}),r(Ca),r(ja),Object.keys(n.state).length>0&&(a(i,".dirty=true;"),a.exit(i,".dirty=true;")),a("a1(",e.shared.context,",a0,",e.batchId,");")}function W(e){if("object"==typeof e&&!pe(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(bt.isDynamic(e[t[n]]))return!0;return!1}}function H(e,t,n){function r(e,t){i.forEach(function(n){var r=a[n];if(bt.isDynamic(r)){var o=e.invoke(t,r);t(l,".",n,"=",o,";")}})}var a=t.static[n];if(a&&W(a)){var o=e.global,i=Object.keys(a),u=!1,s=!1,f=!1,l=e.global.def("{}");i.forEach(function(t){var n=a[t];if(bt.isDynamic(n)){"function"==typeof n&&(n=a[t]=bt.unbox(n));var r=He(n,null);u=u||r.thisDep,f=f||r.propDep,s=s||r.contextDep}else{switch(o(l,".",t,"="),typeof n){case"number":o(n);break;case"string":o('"',n,'"');break;case"object":Array.isArray(n)&&o("[",n.join(),"]");break;default:o(e.link(n))}o(";")}}),t.dynamic[n]=new bt.DynamicVariable(oa,{thisDep:u,contextDep:s,propDep:f,ref:l,append:r}),delete t.static[n]}}function G(e,t,n,r,a){var o=x();o.stats=o.link(a),Object.keys(t.static).forEach(function(e){H(o,t,e)}),Xa.forEach(function(t){H(o,e,t)});var i=_(e,t,n,r,o);return N(o,i),V(o,i),U(o,i),o.compile()}var X=f.Record,Q={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(Q.min=To,Q.max=zo);var $=n.angle_instanced_arrays,K=n.webgl_draw_buffers,J={dirty:!0,profile:h.profile},ee={},te=[],ne={},re={};b(ia,to),b(ua,eo),v(sa,"blendColor",[0,0,0,0]),v(fa,"blendEquationSeparate",[Lo,Lo]),v(la,"blendFuncSeparate",[jo,Co,jo,Co]),b(ca,ro,!0),v(da,"depthFunc",Ro),v(ma,"depthRange",[0,1]),v(ha,"depthMask",!0),v(pa,pa,[!0,!0,!0,!0]),b(ba,Ja),v(va,"cullFace",_o),v(xa,xa,ko),v(ga,ga,1),b(ya,oo),v(Ma,"polygonOffset",[0,0]),b(Sa,io),b(wa,uo),v(Da,"sampleCoverage",[1,!1]),b(Ia,no),v(Fa,"stencilMask",-1),v(Aa,"stencilFunc",[Oo,0,-1]),v(_a,"stencilOpSeparate",[Ao,Po,Po,Po]),v(Ea,"stencilOpSeparate",[_o,Po,Po,Po]),b(ka,ao),v(Ta,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),v(za,za,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var ae={gl:e,context:d,strings:t,next:ee,current:J,draw:c,elements:o,buffer:a,shader:l,attributes:f.state,uniforms:s,framebuffer:u,extensions:n,timer:m,isBufferArgs:Be},oe={primTypes:Nt,compareFuncs:Uo,blendFuncs:Bo,blendEquations:Q,stencilOps:Vo,glTypes:Tt,orientationType:Ho};mt.optional(function(){ae.isArrayLike=pe}),K&&(oe.backBuffer=[_o],oe.drawBuffer=Z(r.maxDrawbuffers,function(e){return 0===e?[0]:Z(e,function(e){return No+e})}));var ie=0;return{next:ee,current:J,procs:function(){var t=x(),n=t.proc("poll"),a=t.proc("refresh"),o=t.block();n(o),a(o);var i=t.shared,u=i.gl,s=i.next,f=i.current;o(f,".dirty=false;"),k(t,n),k(t,a,null,!0);var l,c=e.getExtension("angle_instanced_arrays");c&&(l=t.link(c));for(var d=0;d<r.maxAttributes;++d){var m=a.def(i.attributes,"[",d,"]"),h=t.cond(m,".buffer");h.then(u,".enableVertexAttribArray(",d,");",u,".bindBuffer(",Qa,",",m,".buffer.buffer);",u,".vertexAttribPointer(",d,",",m,".size,",m,".type,",m,".normalized,",m,".stride,",m,".offset);").else(u,".disableVertexAttribArray(",d,");",u,".vertexAttrib4f(",d,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;"),a(h),c&&a(l,".vertexAttribDivisorANGLE(",d,",",m,".divisor);")}return Object.keys(ne).forEach(function(e){var r=ne[e],i=o.def(s,".",e),l=t.block();l("if(",i,"){",u,".enable(",r,")}else{",u,".disable(",r,")}",f,".",e,"=",i,";"),a(l),n("if(",i,"!==",f,".",e,"){",l,"}")}),Object.keys(re).forEach(function(e){var r,i,l=re[e],c=J[e],d=t.block();if(d(u,".",l,"("),pe(c)){var m=c.length;r=t.global.def(s,".",e),i=t.global.def(f,".",e),d(Z(m,function(e){return r+"["+e+"]"}),");",Z(m,function(e){return i+"["+e+"]="+r+"["+e+"];"}).join("")),n("if(",Z(m,function(e){return r+"["+e+"]!=="+i+"["+e+"]"}).join("||"),"){",d,"}")}else r=o.def(s,".",e),i=o.def(f,".",e),d(r,");",f,".",e,"=",r,";"),n("if(",r,"!==",i,"){",d,"}");a(d)}),t.compile()}(),compile:G}}function Xe(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}function Qe(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}function Ze(e){function t(){if(0===V.length)return D&&D.update(),void(Z=null);Z=vt.next(t),d();for(var e=V.length-1;e>=0;--e){var n=V[e];n&&n(_,null,0)}v.flush(),D&&D.update()}function n(){!Z&&V.length>0&&(Z=vt.next(t))}function r(){Z&&(vt.cancel(t),Z=null)}function a(e){e.preventDefault(),g=!0,r(),W.forEach(function(e){e()})}function o(e){v.getError(),g=!1,y.restore(),C.restore(),z.restore(),j.restore(),L.restore(),R.restore(),D&&D.restore(),q.procs.refresh(),n(),H.forEach(function(e){e()})}function i(){V.length=0,r(),U&&(U.removeEventListener(ni,a),U.removeEventListener(ri,o)),C.clear(),R.clear(),L.clear(),j.clear(),O.clear(),z.clear(),D&&D.clear(),Q.forEach(function(e){e()})}function u(e){function t(e){var t={},n={};return Object.keys(e).forEach(function(r){var a=e[r];bt.isDynamic(a)?n[r]=bt.unbox(a,r):t[r]=a}),{dynamic:n,static:t}}function n(e){for(;m.length<e;)m.push(null);return m}function r(e,t){var r;if(g&&mt.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(r=0;r<e;++r)d.call(this,null,t,r);return}if(Array.isArray(e)){for(r=0;r<e.length;++r)d.call(this,e[r],t,r);return}return d.call(this,e,t,0)}if("number"==typeof e){if(e>0)return c.call(this,n(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return c.call(this,e,e.length)}}mt(!!e,"invalid args to regl({...})"),mt.type(e,"object","invalid args to regl({...})");var a=t(e.context||{}),o=t(e.uniforms||{}),i=t(e.attributes||{}),u=t(function(e){function t(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach(function(r){n[e+"."+r]=t[r]})}}var n=Je({},e);return delete n.uniforms,delete n.attributes,delete n.context,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),n}(e)),s={gpuTime:0,cpuTime:0,count:0},f=q.compile(u,i,o,a,s),l=f.draw,c=f.batch,d=f.scope,m=[];return Je(r,{stats:s})}function s(e,t){var n=0;q.procs.poll();var r=t.color;r&&(v.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=Ko),"depth"in t&&(v.clearDepth(+t.depth),n|=Jo),"stencil"in t&&(v.clearStencil(0|t.stencil),n|=ei),mt(!!n,"called regl.clear with no buffer specified"),v.clear(n)}function f(e){if(mt("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)$(Je({framebuffer:e.framebuffer.faces[t]},e),s);else $(e,s);else s(null,e)}function l(e){function t(){function t(){var e=Qe(V,t);V[e]=V[V.length-1],V.length-=1,V.length<=0&&r()}var n=Qe(V,e);mt(n>=0,"cannot cancel a frame twice"),V[n]=t}return mt.type(e,"function","regl.frame() callback must be a function"),V.push(e),n(),{cancel:t}}function c(){var e=Y.viewport,t=Y.scissor_box;e[0]=e[1]=t[0]=t[1]=0,_.viewportWidth=_.framebufferWidth=_.drawingBufferWidth=e[2]=t[2]=v.drawingBufferWidth,_.viewportHeight=_.framebufferHeight=_.drawingBufferHeight=e[3]=t[3]=v.drawingBufferHeight}function d(){_.tick+=1,_.time=h(),c(),q.procs.poll()}function m(){c(),q.procs.refresh(),D&&D.update()}function h(){return(xt()-I)/1e3}function p(e,t){mt.type(t,"function","listener callback must be a function");var n;switch(e){case"frame":return l(t);case"lost":n=W;break;case"restore":n=H;break;case"destroy":n=Q;break;default:mt.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}}var b=G(e);if(!b)return null;var v=b.gl,x=v.getContextAttributes(),g=v.isContextLost(),y=X(v,b);if(!y)return null;var M=N(),S=Xe(),w=y.extensions,D=$o(v,w),I=xt(),F=v.drawingBufferWidth,A=v.drawingBufferHeight,_={tick:0,time:0,viewportWidth:F,viewportHeight:A,framebufferWidth:F,framebufferHeight:A,drawingBufferWidth:F,drawingBufferHeight:A,pixelRatio:b.pixelRatio},E={},k={elements:null,primitive:4,count:-1,offset:0,instances:-1},T=gt(v,w),z=de(v,S,b),O=me(v,w,z,S),P=Ce(v,w,T,z,M),C=je(v,M,S,b),j=Te(v,w,T,function(){q.procs.poll()},_,S,b),L=wr(v,w,T,S,b),R=Oe(v,w,T,j,L,S),q=Ge(v,M,w,T,z,O,j,R,E,P,C,k,_,D,b),B=Le(v,R,q.procs.poll,_,x,w),Y=q.next,U=v.canvas,V=[],W=[],H=[],Q=[b.onDestroy],Z=null;U&&(U.addEventListener(ni,a,!1),U.addEventListener(ri,o,!1));var $=R.setFBO=u({framebuffer:bt.define.call(null,ai,"framebuffer")});m();var K=Je(u,{clear:f,prop:bt.define.bind(null,ai),context:bt.define.bind(null,oi),this:bt.define.bind(null,ii),draw:u({}),buffer:function(e){return z.create(e,ti,!1,!1)},elements:function(e){return O.create(e,!1)},texture:j.create2D,cube:j.createCube,renderbuffer:L.create,framebuffer:R.create,framebufferCube:R.createCube,attributes:x,frame:l,on:p,limits:T,hasExtension:function(e){return T.extensions.indexOf(e.toLowerCase())>=0},read:B,destroy:i,_gl:v,_refresh:m,poll:function(){d(),D&&D.update()},now:h,stats:S});return b.onDone(null,K),K}var $e={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ke=function(e){return Object.prototype.toString.call(e)in $e},Je=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},et=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"],tt=33071,nt=9728,rt=9984,at=9985,ot=9986,it=9987,ut=5126,st=32819,ft=32820,lt=33635,ct=34042,dt={};dt[5120]=dt[5121]=1,dt[5122]=dt[5123]=dt[36193]=dt[lt]=dt[st]=dt[ft]=2,dt[5124]=dt[5125]=dt[ut]=dt[ct]=4;var mt=Je(n,{optional:A,raise:t,commandRaise:w,command:D,parameter:a,commandParameter:I,constructor:f,type:i,commandType:F,isTypedArray:o,nni:u,oneOf:s,shaderError:g,linkError:y,callSite:p,saveCommandRef:M,saveDrawInfo:S,framebufferFormat:_,guessCommand:h,texture2D:T,textureCube:z}),ht=0,pt=0,bt={DynamicVariable:O,define:L,isDynamic:R,unbox:q,accessor:j},vt={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},xt="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},gt=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,a=1;return t.webgl_draw_buffers&&(r=e.getParameter(34852),a=e.getParameter(36063)),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:a,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}},yt=function(e){return Object.keys(e).map(function(t){return e[t]})},Mt=5120,St=5121,wt=5122,Dt=5123,It=5124,Ft=5125,At=5126,_t=Z(8,function(){return[]}),Et={alloc:J,free:ee,allocType:te,freeType:ne},kt={shape:se,flatten:ue},Tt={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},zt={dynamic:35048,stream:35040,static:35044},Ot=kt.flatten,Pt=kt.shape,Ct=35044,jt=35040,Lt=5121,Rt=5126,qt=[];qt[5120]=1,qt[5122]=2,qt[5124]=4,qt[5121]=1,qt[5123]=2,qt[5125]=4,qt[5126]=4;var Nt={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Bt=0,Yt=1,Ut=4,Vt=5120,Wt=5121,Ht=5122,Gt=5123,Xt=5124,Qt=5125,Zt=34963,$t=35040,Kt=35044,Jt=new Float32Array(1),en=new Uint32Array(Jt.buffer),tn=5123,nn=34467,rn=3553,an=34067,on=34069,un=6408,sn=6406,fn=6407,ln=6409,cn=6410,dn=32854,mn=32855,hn=36194,pn=32819,bn=32820,vn=33635,xn=34042,gn=6402,yn=34041,Mn=35904,Sn=35906,wn=36193,Dn=33776,In=33777,Fn=33778,An=33779,_n=35986,En=35987,kn=34798,Tn=35840,zn=35841,On=35842,Pn=35843,Cn=36196,jn=5121,Ln=5123,Rn=5125,qn=5126,Nn=10242,Bn=10243,Yn=10497,Un=33071,Vn=33648,Wn=10240,Hn=10241,Gn=9728,Xn=9729,Qn=9984,Zn=9985,$n=9986,Kn=9987,Jn=33170,er=4352,tr=4353,nr=4354,rr=34046,ar=3317,or=37440,ir=37441,ur=37443,sr=37444,fr=33984,lr=[Qn,$n,Zn,Kn],cr=[0,ln,cn,fn,un],dr={};dr[ln]=dr[sn]=dr[gn]=1,dr[yn]=dr[cn]=2,dr[fn]=dr[Mn]=3,dr[un]=dr[Sn]=4;var mr=be("HTMLCanvasElement"),hr=be("CanvasRenderingContext2D"),pr=be("HTMLImageElement"),br=be("HTMLVideoElement"),vr=Object.keys($e).concat([mr,hr,pr,br]),xr=[];xr[jn]=1,xr[qn]=4,xr[wn]=2,xr[Ln]=2,xr[Rn]=4;var gr=[];gr[dn]=2,gr[mn]=2,gr[hn]=2,gr[yn]=4,gr[Dn]=.5,gr[In]=.5,gr[Fn]=1,gr[An]=1,gr[_n]=.5,gr[En]=1,gr[kn]=1,gr[Tn]=.5,gr[zn]=.25,gr[On]=.5,gr[Pn]=.25,gr[Cn]=.5;var yr=36161,Mr=32854,Sr=[];Sr[Mr]=2,Sr[32855]=2,Sr[36194]=2,Sr[33189]=2,Sr[36168]=1,Sr[34041]=4,Sr[35907]=4,Sr[34836]=16,Sr[34842]=8,Sr[34843]=6;var wr=function(e,t,n,r,a){function o(e){this.id=c++,this.refCount=1,this.renderbuffer=e,this.format=Mr,this.width=0,this.height=0,a.profile&&(this.stats={size:0})}function i(t){var n=t.renderbuffer;mt(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(yr,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete d[t.id],r.renderbufferCount--}function u(t,i){function u(t,r){var o=0,i=0,s=Mr;if("object"==typeof t&&t){var d=t;if("shape"in d){var m=d.shape;mt(Array.isArray(m)&&m.length>=2,"invalid renderbuffer shape"),o=0|m[0],i=0|m[1]}else"radius"in d&&(o=i=0|d.radius),"width"in d&&(o=0|d.width),"height"in d&&(i=0|d.height);"format"in d&&(mt.parameter(d.format,f,"invalid renderbuffer format"),s=f[d.format])}else"number"==typeof t?(o=0|t,i="number"==typeof r?0|r:o):t?mt.raise("invalid arguments to renderbuffer constructor"):o=i=1;if(mt(o>0&&i>0&&o<=n.maxRenderbufferSize&&i<=n.maxRenderbufferSize,"invalid renderbuffer size"),o!==c.width||i!==c.height||s!==c.format)return u.width=c.width=o,u.height=c.height=i,c.format=s,e.bindRenderbuffer(yr,c.renderbuffer),e.renderbufferStorage(yr,s,o,i),a.profile&&(c.stats.size=ze(c.format,c.width,c.height)),u.format=l[c.format],u}function s(t,r){var o=0|t,i=0|r||o;return o===c.width&&i===c.height?u:(mt(o>0&&i>0&&o<=n.maxRenderbufferSize&&i<=n.maxRenderbufferSize,"invalid renderbuffer size"),u.width=c.width=o,u.height=c.height=i,e.bindRenderbuffer(yr,c.renderbuffer),e.renderbufferStorage(yr,c.format,o,i),a.profile&&(c.stats.size=ze(c.format,c.width,c.height)),u)}var c=new o(e.createRenderbuffer());return d[c.id]=c,r.renderbufferCount++,u(t,i),u.resize=s,u._reglType="renderbuffer",u._renderbuffer=c,a.profile&&(u.stats=c.stats),u.destroy=function(){c.decRef()},u}function s(){yt(d).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(yr,t.renderbuffer),e.renderbufferStorage(yr,t.format,t.width,t.height)}),e.bindRenderbuffer(yr,null)}var f={rgba4:Mr,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(f.srgba=35907),t.ext_color_buffer_half_float&&(f.rgba16f=34842,f.rgb16f=34843),t.webgl_color_buffer_float&&(f.rgba32f=34836);var l=[];Object.keys(f).forEach(function(e){var t=f[e];l[t]=e});var c=0,d={};return o.prototype.decRef=function(){--this.refCount<=0&&i(this)},a.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(d).forEach(function(t){e+=d[t].stats.size}),e}),{create:u,clear:function(){yt(d).forEach(i)},restore:s}},Dr=36160,Ir=36161,Fr=3553,Ar=34069,_r=36064,Er=36096,kr=36128,Tr=33306,zr=36053,Or=6402,Pr=[6408],Cr=[];Cr[6408]=4;var jr=[];jr[5121]=1,jr[5126]=4,jr[36193]=2;var Lr=33189,Rr=36168,qr=34041,Nr=[32854,32855,36194,35907,34842,34843,34836],Br={};Br[zr]="complete",Br[36054]="incomplete attachment",Br[36057]="incomplete dimensions",Br[36055]="incomplete, missing attachment",Br[36061]="unsupported";var Yr=5126,Ur=35632,Vr=35633,Wr=35718,Hr=35721,Gr=6408,Xr=5121,Qr=3333,Zr=5126,$r="xyzw".split(""),Kr=5121,Jr=1,ea=2,ta=0,na=1,ra=2,aa=3,oa=4,ia="dither",ua="blend.enable",sa="blend.color",fa="blend.equation",la="blend.func",ca="depth.enable",da="depth.func",ma="depth.range",ha="depth.mask",pa="colorMask",ba="cull.enable",va="cull.face",xa="frontFace",ga="lineWidth",ya="polygonOffset.enable",Ma="polygonOffset.offset",Sa="sample.alpha",wa="sample.enable",Da="sample.coverage",Ia="stencil.enable",Fa="stencil.mask",Aa="stencil.func",_a="stencil.opFront",Ea="stencil.opBack",ka="scissor.enable",Ta="scissor.box",za="viewport",Oa="profile",Pa="framebuffer",Ca="vert",ja="frag",La="elements",Ra="primitive",qa="count",Na="offset",Ba="instances",Ya=Pa+"Width",Ua=Pa+"Height",Va=za+"Width",Wa=za+"Height",Ha="drawingBufferWidth",Ga="drawingBufferHeight",Xa=[la,fa,Aa,_a,Ea,Da,za,Ta,Ma],Qa=34962,Za=34963,$a=3553,Ka=34067,Ja=2884,eo=3042,to=3024,no=2960,ro=2929,ao=3089,oo=32823,io=32926,uo=32928,so=5126,fo=35664,lo=35665,co=35666,mo=5124,ho=35667,po=35668,bo=35669,vo=35670,xo=35671,go=35672,yo=35673,Mo=35674,So=35675,wo=35676,Do=35678,Io=35680,Fo=4,Ao=1028,_o=1029,Eo=2304,ko=2305,To=32775,zo=32776,Oo=519,Po=7680,Co=0,jo=1,Lo=32774,Ro=513,qo=36160,No=36064,Bo={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Yo=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Uo={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Vo={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Wo={frag:35632,vert:35633},Ho={cw:Eo,ccw:ko},Go=new Ue(!1,!1,!1,function(){}),Xo=34918,Qo=34919,Zo=35007,$o=function(e,t){function n(){return d.pop()||c.createQueryEXT()}function r(e){d.push(e)}function a(e){var t=n();c.beginQueryEXT(Zo,t),m.push(t),f(m.length-1,m.length,e)}function o(){c.endQueryEXT(Zo)}function i(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}function u(){return h.pop()||new i}function s(e){h.push(e)}function f(e,t,n){var r=u();r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,p.push(r)}function l(){var e,t,n=m.length;if(0!==n){v.length=Math.max(v.length,n+1),b.length=Math.max(b.length,n+1),b[0]=0,v[0]=0;var a=0;for(e=0,t=0;t<m.length;++t){var o=m[t];c.getQueryObjectEXT(o,Qo)?(a+=c.getQueryObjectEXT(o,Xo),r(o)):m[e++]=o,b[t+1]=a,v[t+1]=e}for(m.length=e,e=0,t=0;t<p.length;++t){var i=p[t],u=i.startQueryIndex,f=i.endQueryIndex;i.sum+=b[f]-b[u];var l=v[u],d=v[f];d===l?(i.stats.gpuTime+=i.sum/1e6,s(i)):(i.startQueryIndex=l,i.endQueryIndex=d,p[e++]=i)}p.length=e}}var c=t.ext_disjoint_timer_query;if(!c)return null;var d=[],m=[],h=[],p=[],b=[],v=[];return{beginQuery:a,endQuery:o,pushScopeStats:f,update:l,getNumPendingQueries:function(){return m.length},clear:function(){d.push.apply(d,m);for(var e=0;e<d.length;e++)c.deleteQueryEXT(d[e]);m.length=0,d.length=0},restore:function(){m.length=0,d.length=0}}},Ko=16384,Jo=256,ei=1024,ti=34962,ni="webglcontextlost",ri="webglcontextrestored",ai=1,oi=2,ii=3;return Ze})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){O.cubeTexture=e;var t=(0,y.default)(_)(O,z,P),n=(0,S.default)(_)(O,z,P);_.frame(function(){_.clear({color:[0,0,0,0],depth:1,framebuffer:T}),_.clear({color:[0,0,0,0],depth:1}),t(),n(),E.tick()})}var o=n(13),i=r(o),u=n(14),s=r(u),f=n(15),l=r(f),c=n(1),d=r(c),m=n(8),h=r(m),p=n(10),b=r(p),v=n(12),x=r(v),g=n(9),y=r(g),M=n(11),S=r(M),w=document.querySelector(".canvas-container"),D=w.appendChild(document.createElement("canvas"));window.addEventListener("resize",(0,i.default)(D),!1);var I=D.getBoundingClientRect(),F=I.width,A=I.height,_=(0,l.default)({canvas:D,extensions:["OES_texture_float"],optionalExtensions:["oes_texture_float_linear"]}),E=(0,s.default)(D);E.distance=3,E.rotation=new Float32Array([-.20194266736507416,-.4338509142398834,-.12594525516033173,.8689823746681213]);var k=_.texture({data:(0,x.default)(),wrapS:"clamp",wrapT:"clamp",mag:"linear",min:"linear",x:0,y:0,width:256,height:1,alignment:4}),T=_.framebuffer({width:F,height:A,color:_.texture({width:F,height:A,x:0,y:0,mag:"linear",min:"linear",wrapS:"clamp",wrapT:"clamp",type:"float"}),colorType:"float",alignment:4}),z={positions:_.buffer(h.default.positions)},O={fbo:T,transferTex:k,model:d.default.identity([]),view:function(){return E.view()}},P=h.default.faces;(0,b.default)("textures/foot.raw.png").then(function(e){return _.texture({mag:"linear",min:"linear",wrapS:"clamp",wrapT:"clamp",flipY:!0,alignment:4,data:e})}).then(a)},function(e,t){function n(e){if(e===window||e===document.body)return[window.innerWidth,window.innerHeight];if(!e.parentNode){var t=!0;document.body.appendChild(e)}var n=e.getBoundingClientRect(),a=getComputedStyle(e),o=(0|n.height)+r(a.getPropertyValue("margin-top"))+r(a.getPropertyValue("margin-bottom")),i=(0|n.width)+r(a.getPropertyValue("margin-left"))+r(a.getPropertyValue("margin-right"));return t&&document.body.removeChild(e),[i,o]}function r(e){return parseFloat(e)||0}e.exports=n},function(e,t){function n(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],f=t[7],l=t[8],c=t[9],d=t[10],m=t[11],h=t[12],p=t[13],b=t[14],v=t[15];return e[0]=u*(d*v-m*b)-c*(s*v-f*b)+p*(s*m-f*d),e[1]=-(r*(d*v-m*b)-c*(a*v-o*b)+p*(a*m-o*d)),e[2]=r*(s*v-f*b)-u*(a*v-o*b)+p*(a*f-o*s),e[3]=-(r*(s*m-f*d)-u*(a*m-o*d)+c*(a*f-o*s)),e[4]=-(i*(d*v-m*b)-l*(s*v-f*b)+h*(s*m-f*d)),e[5]=n*(d*v-m*b)-l*(a*v-o*b)+h*(a*m-o*d),e[6]=-(n*(s*v-f*b)-i*(a*v-o*b)+h*(a*f-o*s)),e[7]=n*(s*m-f*d)-i*(a*m-o*d)+l*(a*f-o*s),e[8]=i*(c*v-m*p)-l*(u*v-f*p)+h*(u*m-f*c),e[9]=-(n*(c*v-m*p)-l*(r*v-o*p)+h*(r*m-o*c)),e[10]=n*(u*v-f*p)-i*(r*v-o*p)+h*(r*f-o*u),e[11]=-(n*(u*m-f*c)-i*(r*m-o*c)+l*(r*f-o*u)),e[12]=-(i*(c*b-d*p)-l*(u*b-s*p)+h*(u*d-s*c)),e[13]=n*(c*b-d*p)-l*(r*b-a*p)+h*(r*d-a*c),e[14]=-(n*(u*b-s*p)-i*(r*b-a*p)+h*(r*s-a*u)),e[15]=n*(u*d-s*c)-i*(r*d-a*c)+l*(r*s-a*u),e}e.exports=n},function(e,t){function n(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}e.exports=n},function(e,t){function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}e.exports=n},function(e,t){function n(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.exports=n},function(e,t){function n(e){var t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],i=e[5],u=e[6],s=e[7],f=e[8],l=e[9],c=e[10],d=e[11],m=e[12],h=e[13],p=e[14],b=e[15];return(t*i-n*o)*(c*b-d*p)-(t*u-r*o)*(l*b-d*h)+(t*s-a*o)*(l*p-c*h)+(n*u-r*i)*(f*b-d*m)-(n*s-a*i)*(f*p-c*m)+(r*s-a*u)*(f*h-l*m)}e.exports=n},function(e,t){function n(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n+n,u=r+r,s=a+a,f=n*i,l=r*i,c=r*u,d=a*i,m=a*u,h=a*s,p=o*i,b=o*u,v=o*s;return e[0]=1-c-h,e[1]=l+v,e[2]=d-b,e[3]=0,e[4]=l-v,e[5]=1-f-h,e[6]=m+p,e[7]=0,e[8]=d+b,e[9]=m-p,e[10]=1-f-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.exports=n},function(e,t){function n(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=r+r,s=a+a,f=o+o,l=r*u,c=r*s,d=r*f,m=a*s,h=a*f,p=o*f,b=i*u,v=i*s,x=i*f;return e[0]=1-(m+p),e[1]=c+x,e[2]=d-v,e[3]=0,e[4]=c-x,e[5]=1-(l+p),e[6]=h+b,e[7]=0,e[8]=d+v,e[9]=h-b,e[10]=1-(l+m),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}e.exports=n},function(e,t){function n(e,t,n,r,a,o,i){var u=1/(n-t),s=1/(a-r),f=1/(o-i);return e[0]=2*o*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*s,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(a+r)*s,e[10]=(i+o)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*o*2*f,e[15]=0,e}e.exports=n},function(e,t){function n(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],f=t[7],l=t[8],c=t[9],d=t[10],m=t[11],h=t[12],p=t[13],b=t[14],v=t[15],x=n*u-r*i,g=n*s-a*i,y=n*f-o*i,M=r*s-a*u,S=r*f-o*u,w=a*f-o*s,D=l*p-c*h,I=l*b-d*h,F=l*v-m*h,A=c*b-d*p,_=c*v-m*p,E=d*v-m*b,k=x*E-g*_+y*A+M*F-S*I+w*D;return k?(k=1/k,e[0]=(u*E-s*_+f*A)*k,e[1]=(a*_-r*E-o*A)*k,e[2]=(p*w-b*S+v*M)*k,e[3]=(d*S-c*w-m*M)*k,e[4]=(s*F-i*E-f*I)*k,e[5]=(n*E-a*F+o*I)*k,e[6]=(b*y-h*w-v*g)*k,e[7]=(l*w-d*y+m*g)*k,e[8]=(i*_-u*F+f*D)*k,e[9]=(r*F-n*_-o*D)*k,e[10]=(h*S-p*y+v*x)*k,e[11]=(c*y-l*S-m*x)*k,e[12]=(u*I-i*A-s*D)*k,e[13]=(n*A-r*I+a*D)*k,e[14]=(p*g-h*M-b*x)*k,e[15]=(l*M-c*g+d*x)*k,e):null}e.exports=n},function(e,t,n){function r(e,t,n,r){var o,i,u,s,f,l,c,d,m,h,p=t[0],b=t[1],v=t[2],x=r[0],g=r[1],y=r[2],M=n[0],S=n[1],w=n[2];return Math.abs(p-M)<1e-6&&Math.abs(b-S)<1e-6&&Math.abs(v-w)<1e-6?a(e):(c=p-M,d=b-S,m=v-w,h=1/Math.sqrt(c*c+d*d+m*m),c*=h,d*=h,m*=h,o=g*m-y*d,i=y*c-x*m,u=x*d-g*c,h=Math.sqrt(o*o+i*i+u*u),h?(h=1/h,o*=h,i*=h,u*=h):(o=0,i=0,u=0),s=d*u-m*i,f=m*o-c*u,l=c*i-d*o,h=Math.sqrt(s*s+f*f+l*l),h?(h=1/h,s*=h,f*=h,l*=h):(s=0,f=0,l=0),e[0]=o,e[1]=s,e[2]=c,e[3]=0,e[4]=i,e[5]=f,e[6]=d,e[7]=0,e[8]=u,e[9]=l,e[10]=m,e[11]=0,e[12]=-(o*p+i*b+u*v),e[13]=-(s*p+f*b+l*v),e[14]=-(c*p+d*b+m*v),e[15]=1,e)}var a=n(4);e.exports=r},function(e,t){function n(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=t[6],l=t[7],c=t[8],d=t[9],m=t[10],h=t[11],p=t[12],b=t[13],v=t[14],x=t[15],g=n[0],y=n[1],M=n[2],S=n[3];return e[0]=g*r+y*u+M*c+S*p,e[1]=g*a+y*s+M*d+S*b,e[2]=g*o+y*f+M*m+S*v,e[3]=g*i+y*l+M*h+S*x,g=n[4],y=n[5],M=n[6],S=n[7],e[4]=g*r+y*u+M*c+S*p,e[5]=g*a+y*s+M*d+S*b,e[6]=g*o+y*f+M*m+S*v,e[7]=g*i+y*l+M*h+S*x,g=n[8],y=n[9],M=n[10],S=n[11],e[8]=g*r+y*u+M*c+S*p,e[9]=g*a+y*s+M*d+S*b,e[10]=g*o+y*f+M*m+S*v,e[11]=g*i+y*l+M*h+S*x,g=n[12],y=n[13],M=n[14],S=n[15],e[12]=g*r+y*u+M*c+S*p,e[13]=g*a+y*s+M*d+S*b,e[14]=g*o+y*f+M*m+S*v,e[15]=g*i+y*l+M*h+S*x,e}e.exports=n},function(e,t){function n(e,t,n,r,a,o,i){var u=1/(t-n),s=1/(r-a),f=1/(o-i);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(a+r)*s,e[14]=(i+o)*f,e[15]=1,e}e.exports=n},function(e,t){function n(e,t,n,r,a){var o=1/Math.tan(t/2),i=1/(r-a);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(a+r)*i,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*a*r*i,e[15]=0,e}e.exports=n},function(e,t){function n(e,t,n,r){var a=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),s=2/(i+u),f=2/(a+o);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=-(i-u)*s*.5,e[9]=(a-o)*f*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}e.exports=n},function(e,t){function n(e,t,n,r){var a,o,i,u,s,f,l,c,d,m,h,p,b,v,x,g,y,M,S,w,D,I,F,A,_=r[0],E=r[1],k=r[2],T=Math.sqrt(_*_+E*E+k*k);return Math.abs(T)<1e-6?null:(T=1/T,_*=T,E*=T,k*=T,a=Math.sin(n),o=Math.cos(n),i=1-o,u=t[0],s=t[1],f=t[2],l=t[3],c=t[4],d=t[5],m=t[6],h=t[7],p=t[8],b=t[9],v=t[10],x=t[11],g=_*_*i+o,y=E*_*i+k*a,M=k*_*i-E*a,S=_*E*i-k*a,w=E*E*i+o,D=k*E*i+_*a,I=_*k*i+E*a,F=E*k*i-_*a,A=k*k*i+o,e[0]=u*g+c*y+p*M,e[1]=s*g+d*y+b*M,e[2]=f*g+m*y+v*M,e[3]=l*g+h*y+x*M,e[4]=u*S+c*w+p*D,e[5]=s*S+d*w+b*D,e[6]=f*S+m*w+v*D,e[7]=l*S+h*w+x*D,e[8]=u*I+c*F+p*A,e[9]=s*I+d*F+b*A,e[10]=f*I+m*F+v*A,e[11]=l*I+h*F+x*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}e.exports=n},function(e,t){function n(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[4],i=t[5],u=t[6],s=t[7],f=t[8],l=t[9],c=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*a+f*r,e[5]=i*a+l*r,e[6]=u*a+c*r,e[7]=s*a+d*r,e[8]=f*a-o*r,e[9]=l*a-i*r,e[10]=c*a-u*r,e[11]=d*a-s*r,e}e.exports=n},function(e,t){function n(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],u=t[2],s=t[3],f=t[8],l=t[9],c=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a-f*r,e[1]=i*a-l*r,e[2]=u*a-c*r,e[3]=s*a-d*r,e[8]=o*r+f*a,e[9]=i*r+l*a,e[10]=u*r+c*a,e[11]=s*r+d*a,e}e.exports=n},function(e,t){function n(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],u=t[2],s=t[3],f=t[4],l=t[5],c=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a+f*r,e[1]=i*a+l*r,e[2]=u*a+c*r,e[3]=s*a+d*r,e[4]=f*a-o*r,e[5]=l*a-i*r,e[6]=c*a-u*r,e[7]=d*a-s*r,e}e.exports=n},function(e,t){function n(e,t,n){var r=n[0],a=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}e.exports=n},function(e,t){function n(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}e.exports=n},function(e,t){function n(e,t,n){var r,a,o,i,u,s,f,l,c,d,m,h,p=n[0],b=n[1],v=n[2];return t===e?(e[12]=t[0]*p+t[4]*b+t[8]*v+t[12],e[13]=t[1]*p+t[5]*b+t[9]*v+t[13],e[14]=t[2]*p+t[6]*b+t[10]*v+t[14],e[15]=t[3]*p+t[7]*b+t[11]*v+t[15]):(r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=t[6],l=t[7],c=t[8],d=t[9],m=t[10],h=t[11],e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=u,e[5]=s,e[6]=f,e[7]=l,e[8]=c,e[9]=d,e[10]=m,e[11]=h,e[12]=r*p+u*b+c*v+t[12],e[13]=a*p+s*b+d*v+t[13],e[14]=o*p+f*b+m*v+t[14],e[15]=i*p+l*b+h*v+t[15]),e}e.exports=n},function(e,t){function n(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],o=t[6],i=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=a,e[13]=i,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}e.exports=n},function(e,t,n){t.glMatrix=n(0),t.mat2=n(41),t.mat2d=n(42),t.mat3=n(5),t.mat4=n(43),t.quat=n(44),t.vec2=n(45),t.vec3=n(6),t.vec4=n(7)},function(e,t,n){var r=n(0),a={};a.create=function(){var e=new r.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.clone=function(e){var t=new r.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.fromValues=function(e,t,n,a){var o=new r.ARRAY_TYPE(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=a,o},a.set=function(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e},a.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},a.invert=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n*o-a*r;return i?(i=1/i,e[0]=o*i,e[1]=-r*i,e[2]=-a*i,e[3]=n*i,e):null},a.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},a.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},a.multiply=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=n[0],s=n[1],f=n[2],l=n[3];return e[0]=r*u+o*s,e[1]=a*u+i*s,e[2]=r*f+o*l,e[3]=a*f+i*l,e},a.mul=a.multiply,a.rotate=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+o*u,e[1]=a*s+i*u,e[2]=r*-u+o*s,e[3]=a*-u+i*s,e},a.scale=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=n[0],s=n[1];return e[0]=r*u,e[1]=a*u,e[2]=o*s,e[3]=i*s,e},a.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e},a.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},a.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},a.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},a.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},a.sub=a.subtract,a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},a.equals=function(e,t){var n=e[0],a=e[1],o=e[2],i=e[3],u=t[0],s=t[1],f=t[2],l=t[3];return Math.abs(n-u)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-s)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(o-f)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(i-l)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))},a.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},a.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},e.exports=a},function(e,t,n){var r=n(0),a={};a.create=function(){var e=new r.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},a.clone=function(e){var t=new r.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},a.fromValues=function(e,t,n,a,o,i){var u=new r.ARRAY_TYPE(6);return u[0]=e,u[1]=t,u[2]=n,u[3]=a,u[4]=o,u[5]=i,u},a.set=function(e,t,n,r,a,o,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=o,e[5]=i,e},a.invert=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=n*o-r*a;return s?(s=1/s,e[0]=o*s,e[1]=-r*s,e[2]=-a*s,e[3]=n*s,e[4]=(a*u-o*i)*s,e[5]=(r*i-n*u)*s,e):null},a.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},a.multiply=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=n[0],l=n[1],c=n[2],d=n[3],m=n[4],h=n[5];return e[0]=r*f+o*l,e[1]=a*f+i*l,e[2]=r*c+o*d,e[3]=a*c+i*d,e[4]=r*m+o*h+u,e[5]=a*m+i*h+s,e},a.mul=a.multiply,a.rotate=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=Math.sin(n),l=Math.cos(n);return e[0]=r*l+o*f,e[1]=a*l+i*f,e[2]=r*-f+o*l,e[3]=a*-f+i*l,e[4]=u,e[5]=s,e},a.scale=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=n[0],l=n[1];return e[0]=r*f,e[1]=a*f,e[2]=o*l,e[3]=i*l,e[4]=u,e[5]=s,e},a.translate=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=n[0],l=n[1];return e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=r*f+o*l+u,e[5]=a*f+i*l+s,e},a.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e},a.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},a.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},a.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},a.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e},a.sub=a.subtract,a.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},a.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e},a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},a.equals=function(e,t){var n=e[0],a=e[1],o=e[2],i=e[3],u=e[4],s=e[5],f=t[0],l=t[1],c=t[2],d=t[3],m=t[4],h=t[5];return Math.abs(n-f)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-l)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(i-d)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(u-m)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(s-h)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))},e.exports=a},function(e,t,n){var r=n(0),a={scalar:{},SIMD:{}};a.create=function(){var e=new r.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.clone=function(e){var t=new r.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.fromValues=function(e,t,n,a,o,i,u,s,f,l,c,d,m,h,p,b){var v=new r.ARRAY_TYPE(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=a,v[4]=o,v[5]=i,v[6]=u,v[7]=s,v[8]=f,v[9]=l,v[10]=c,v[11]=d,v[12]=m,v[13]=h,v[14]=p,v[15]=b,v},a.set=function(e,t,n,r,a,o,i,u,s,f,l,c,d,m,h,p,b){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=o,e[5]=i,e[6]=u,e[7]=s,e[8]=f,e[9]=l,e[10]=c,e[11]=d,e[12]=m,e[13]=h,e[14]=p,e[15]=b,e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.scalar.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],o=t[6],i=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=a,e[13]=i,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},a.SIMD.transpose=function(e,t){var n,r,a,o,i,u,s,f,l,c;return n=SIMD.Float32x4.load(t,0),r=SIMD.Float32x4.load(t,4),a=SIMD.Float32x4.load(t,8),o=SIMD.Float32x4.load(t,12),i=SIMD.Float32x4.shuffle(n,r,0,1,4,5),u=SIMD.Float32x4.shuffle(a,o,0,1,4,5),s=SIMD.Float32x4.shuffle(i,u,0,2,4,6),f=SIMD.Float32x4.shuffle(i,u,1,3,5,7),SIMD.Float32x4.store(e,0,s),SIMD.Float32x4.store(e,4,f),i=SIMD.Float32x4.shuffle(n,r,2,3,6,7),u=SIMD.Float32x4.shuffle(a,o,2,3,6,7),l=SIMD.Float32x4.shuffle(i,u,0,2,4,6),c=SIMD.Float32x4.shuffle(i,u,1,3,5,7),SIMD.Float32x4.store(e,8,l),SIMD.Float32x4.store(e,12,c),e},a.transpose=r.USE_SIMD?a.SIMD.transpose:a.scalar.transpose,a.scalar.invert=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],f=t[7],l=t[8],c=t[9],d=t[10],m=t[11],h=t[12],p=t[13],b=t[14],v=t[15],x=n*u-r*i,g=n*s-a*i,y=n*f-o*i,M=r*s-a*u,S=r*f-o*u,w=a*f-o*s,D=l*p-c*h,I=l*b-d*h,F=l*v-m*h,A=c*b-d*p,_=c*v-m*p,E=d*v-m*b,k=x*E-g*_+y*A+M*F-S*I+w*D;return k?(k=1/k,e[0]=(u*E-s*_+f*A)*k,e[1]=(a*_-r*E-o*A)*k,e[2]=(p*w-b*S+v*M)*k,e[3]=(d*S-c*w-m*M)*k,e[4]=(s*F-i*E-f*I)*k,e[5]=(n*E-a*F+o*I)*k,e[6]=(b*y-h*w-v*g)*k,e[7]=(l*w-d*y+m*g)*k,e[8]=(i*_-u*F+f*D)*k,e[9]=(r*F-n*_-o*D)*k,e[10]=(h*S-p*y+v*x)*k,e[11]=(c*y-l*S-m*x)*k,e[12]=(u*I-i*A-s*D)*k,e[13]=(n*A-r*I+a*D)*k,e[14]=(p*g-h*M-b*x)*k,e[15]=(l*M-c*g+d*x)*k,e):null},a.SIMD.invert=function(e,t){var n,r,a,o,i,u,s,f,l,c,d=SIMD.Float32x4.load(t,0),m=SIMD.Float32x4.load(t,4),h=SIMD.Float32x4.load(t,8),p=SIMD.Float32x4.load(t,12);return i=SIMD.Float32x4.shuffle(d,m,0,1,4,5),r=SIMD.Float32x4.shuffle(h,p,0,1,4,5),n=SIMD.Float32x4.shuffle(i,r,0,2,4,6),r=SIMD.Float32x4.shuffle(r,i,1,3,5,7),i=SIMD.Float32x4.shuffle(d,m,2,3,6,7),o=SIMD.Float32x4.shuffle(h,p,2,3,6,7),a=SIMD.Float32x4.shuffle(i,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,i,1,3,5,7),i=SIMD.Float32x4.mul(a,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),u=SIMD.Float32x4.mul(r,i),s=SIMD.Float32x4.mul(n,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,i),u),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),i=SIMD.Float32x4.mul(r,a),i=SIMD.Float32x4.swizzle(i,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),u),l=SIMD.Float32x4.mul(n,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(o,i)),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),i=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,2,3,0,1),o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),a=SIMD.Float32x4.swizzle(a,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),u),f=SIMD.Float32x4.mul(n,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(a,i)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),i=SIMD.Float32x4.mul(n,r),i=SIMD.Float32x4.swizzle(i,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),f),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,i),l),i=SIMD.Float32x4.swizzle(i,2,3,0,1),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,i),f),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(a,i)),i=SIMD.Float32x4.mul(n,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(a,i)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,i),f),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),s),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(r,i)),i=SIMD.Float32x4.mul(n,a),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),s),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(r,i)),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(o,i)),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,i),l),c=SIMD.Float32x4.mul(n,u),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,2,3,0,1),c),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,1,0,3,2),c),i=SIMD.Float32x4.reciprocalApproximation(c),c=SIMD.Float32x4.sub(SIMD.Float32x4.add(i,i),SIMD.Float32x4.mul(c,SIMD.Float32x4.mul(i,i))),(c=SIMD.Float32x4.swizzle(c,0,0,0,0))?(SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(c,u)),SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(c,s)),SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(c,f)),SIMD.Float32x4.store(e,12,SIMD.Float32x4.mul(c,l)),e):null},a.invert=r.USE_SIMD?a.SIMD.invert:a.scalar.invert,a.scalar.adjoint=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],s=t[6],f=t[7],l=t[8],c=t[9],d=t[10],m=t[11],h=t[12],p=t[13],b=t[14],v=t[15];return e[0]=u*(d*v-m*b)-c*(s*v-f*b)+p*(s*m-f*d),e[1]=-(r*(d*v-m*b)-c*(a*v-o*b)+p*(a*m-o*d)),e[2]=r*(s*v-f*b)-u*(a*v-o*b)+p*(a*f-o*s),e[3]=-(r*(s*m-f*d)-u*(a*m-o*d)+c*(a*f-o*s)),e[4]=-(i*(d*v-m*b)-l*(s*v-f*b)+h*(s*m-f*d)),e[5]=n*(d*v-m*b)-l*(a*v-o*b)+h*(a*m-o*d),e[6]=-(n*(s*v-f*b)-i*(a*v-o*b)+h*(a*f-o*s)),e[7]=n*(s*m-f*d)-i*(a*m-o*d)+l*(a*f-o*s),e[8]=i*(c*v-m*p)-l*(u*v-f*p)+h*(u*m-f*c),e[9]=-(n*(c*v-m*p)-l*(r*v-o*p)+h*(r*m-o*c)),e[10]=n*(u*v-f*p)-i*(r*v-o*p)+h*(r*f-o*u),e[11]=-(n*(u*m-f*c)-i*(r*m-o*c)+l*(r*f-o*u)),e[12]=-(i*(c*b-d*p)-l*(u*b-s*p)+h*(u*d-s*c)),e[13]=n*(c*b-d*p)-l*(r*b-a*p)+h*(r*d-a*c),e[14]=-(n*(u*b-s*p)-i*(r*b-a*p)+h*(r*s-a*u)),e[15]=n*(u*d-s*c)-i*(r*d-a*c)+l*(r*s-a*u),e},a.SIMD.adjoint=function(e,t){var n,r,a,o,i,u,s,f,l,c,d,m,h,n=SIMD.Float32x4.load(t,0),r=SIMD.Float32x4.load(t,4),a=SIMD.Float32x4.load(t,8),o=SIMD.Float32x4.load(t,12);return l=SIMD.Float32x4.shuffle(n,r,0,1,4,5),u=SIMD.Float32x4.shuffle(a,o,0,1,4,5),i=SIMD.Float32x4.shuffle(l,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,l,1,3,5,7),l=SIMD.Float32x4.shuffle(n,r,2,3,6,7),f=SIMD.Float32x4.shuffle(a,o,2,3,6,7),s=SIMD.Float32x4.shuffle(l,f,0,2,4,6),f=SIMD.Float32x4.shuffle(f,l,1,3,5,7),l=SIMD.Float32x4.mul(s,f),l=SIMD.Float32x4.swizzle(l,1,0,3,2),c=SIMD.Float32x4.mul(u,l),d=SIMD.Float32x4.mul(i,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,l),c),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,l),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),l=SIMD.Float32x4.mul(u,s),l=SIMD.Float32x4.swizzle(l,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,l),c),h=SIMD.Float32x4.mul(i,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(f,l)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,l),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,3,0,1),f),l=SIMD.Float32x4.swizzle(l,1,0,3,2),s=SIMD.Float32x4.swizzle(s,2,3,0,1),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,l),c),m=SIMD.Float32x4.mul(i,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(s,l)),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,l),m),m=SIMD.Float32x4.swizzle(m,2,3,0,1),l=SIMD.Float32x4.mul(i,u),l=SIMD.Float32x4.swizzle(l,1,0,3,2),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,l),m),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,l),h),l=SIMD.Float32x4.swizzle(l,2,3,0,1),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,l),m),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(s,l)),l=SIMD.Float32x4.mul(i,f),l=SIMD.Float32x4.swizzle(l,1,0,3,2),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(s,l)),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,l),m),l=SIMD.Float32x4.swizzle(l,2,3,0,1),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,l),d),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(u,l)),l=SIMD.Float32x4.mul(i,s),l=SIMD.Float32x4.swizzle(l,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,l),d),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(u,l)),l=SIMD.Float32x4.swizzle(l,2,3,0,1),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(f,l)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,l),h),SIMD.Float32x4.store(e,0,c),SIMD.Float32x4.store(e,4,d),SIMD.Float32x4.store(e,8,m),SIMD.Float32x4.store(e,12,h),e},a.adjoint=r.USE_SIMD?a.SIMD.adjoint:a.scalar.adjoint,a.determinant=function(e){var t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],i=e[5],u=e[6],s=e[7],f=e[8],l=e[9],c=e[10],d=e[11],m=e[12],h=e[13],p=e[14],b=e[15];return(t*i-n*o)*(c*b-d*p)-(t*u-r*o)*(l*b-d*h)+(t*s-a*o)*(l*p-c*h)+(n*u-r*i)*(f*b-d*m)-(n*s-a*i)*(f*p-c*m)+(r*s-a*u)*(f*h-l*m)},a.SIMD.multiply=function(e,t,n){var r=SIMD.Float32x4.load(t,0),a=SIMD.Float32x4.load(t,4),o=SIMD.Float32x4.load(t,8),i=SIMD.Float32x4.load(t,12),u=SIMD.Float32x4.load(n,0),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),i))));SIMD.Float32x4.store(e,0,s);var f=SIMD.Float32x4.load(n,4),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),i))));SIMD.Float32x4.store(e,4,l);var c=SIMD.Float32x4.load(n,8),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),i))));SIMD.Float32x4.store(e,8,d);var m=SIMD.Float32x4.load(n,12),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,3,3,3,3),i))));return SIMD.Float32x4.store(e,12,h),e},a.scalar.multiply=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=t[6],l=t[7],c=t[8],d=t[9],m=t[10],h=t[11],p=t[12],b=t[13],v=t[14],x=t[15],g=n[0],y=n[1],M=n[2],S=n[3];return e[0]=g*r+y*u+M*c+S*p,e[1]=g*a+y*s+M*d+S*b,e[2]=g*o+y*f+M*m+S*v,e[3]=g*i+y*l+M*h+S*x,g=n[4],y=n[5],M=n[6],S=n[7],e[4]=g*r+y*u+M*c+S*p,e[5]=g*a+y*s+M*d+S*b,e[6]=g*o+y*f+M*m+S*v,e[7]=g*i+y*l+M*h+S*x,g=n[8],y=n[9],M=n[10],S=n[11],e[8]=g*r+y*u+M*c+S*p,e[9]=g*a+y*s+M*d+S*b,e[10]=g*o+y*f+M*m+S*v,e[11]=g*i+y*l+M*h+S*x,g=n[12],y=n[13],M=n[14],S=n[15],e[12]=g*r+y*u+M*c+S*p,e[13]=g*a+y*s+M*d+S*b,e[14]=g*o+y*f+M*m+S*v,e[15]=g*i+y*l+M*h+S*x,e},a.multiply=r.USE_SIMD?a.SIMD.multiply:a.scalar.multiply,a.mul=a.multiply,a.scalar.translate=function(e,t,n){var r,a,o,i,u,s,f,l,c,d,m,h,p=n[0],b=n[1],v=n[2];return t===e?(e[12]=t[0]*p+t[4]*b+t[8]*v+t[12],e[13]=t[1]*p+t[5]*b+t[9]*v+t[13],e[14]=t[2]*p+t[6]*b+t[10]*v+t[14],e[15]=t[3]*p+t[7]*b+t[11]*v+t[15]):(r=t[0],a=t[1],o=t[2],i=t[3],u=t[4],s=t[5],f=t[6],l=t[7],c=t[8],d=t[9],m=t[10],h=t[11],e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=u,e[5]=s,e[6]=f,e[7]=l,e[8]=c,e[9]=d,e[10]=m,e[11]=h,e[12]=r*p+u*b+c*v+t[12],e[13]=a*p+s*b+d*v+t[13],e[14]=o*p+f*b+m*v+t[14],e[15]=i*p+l*b+h*v+t[15]),e},a.SIMD.translate=function(e,t,n){var r=SIMD.Float32x4.load(t,0),a=SIMD.Float32x4.load(t,4),o=SIMD.Float32x4.load(t,8),i=SIMD.Float32x4.load(t,12),u=SIMD.Float32x4(n[0],n[1],n[2],0);t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(u,0,0,0,0)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(u,1,1,1,1)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(u,2,2,2,2));var s=SIMD.Float32x4.add(r,SIMD.Float32x4.add(a,SIMD.Float32x4.add(o,i)));return SIMD.Float32x4.store(e,12,s),e},a.translate=r.USE_SIMD?a.SIMD.translate:a.scalar.translate,a.scalar.scale=function(e,t,n){var r=n[0],a=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.SIMD.scale=function(e,t,n){var r,a,o,i=SIMD.Float32x4(n[0],n[1],n[2],0);return r=SIMD.Float32x4.load(t,0),SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(i,0,0,0,0))),a=SIMD.Float32x4.load(t,4),SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(i,1,1,1,1))),o=SIMD.Float32x4.load(t,8),SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(i,2,2,2,2))),e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.scale=r.USE_SIMD?a.SIMD.scale:a.scalar.scale,a.rotate=function(e,t,n,a){var o,i,u,s,f,l,c,d,m,h,p,b,v,x,g,y,M,S,w,D,I,F,A,_,E=a[0],k=a[1],T=a[2],z=Math.sqrt(E*E+k*k+T*T);return Math.abs(z)<r.EPSILON?null:(z=1/z,E*=z,k*=z,T*=z,o=Math.sin(n),i=Math.cos(n),u=1-i,s=t[0],f=t[1],l=t[2],c=t[3],d=t[4],m=t[5],h=t[6],p=t[7],b=t[8],v=t[9],x=t[10],g=t[11],y=E*E*u+i,M=k*E*u+T*o,S=T*E*u-k*o,w=E*k*u-T*o,D=k*k*u+i,I=T*k*u+E*o,F=E*T*u+k*o,A=k*T*u-E*o,_=T*T*u+i,e[0]=s*y+d*M+b*S,e[1]=f*y+m*M+v*S,e[2]=l*y+h*M+x*S,e[3]=c*y+p*M+g*S,e[4]=s*w+d*D+b*I,e[5]=f*w+m*D+v*I,e[6]=l*w+h*D+x*I,e[7]=c*w+p*D+g*I,e[8]=s*F+d*A+b*_,e[9]=f*F+m*A+v*_,e[10]=l*F+h*A+x*_,e[11]=c*F+p*A+g*_,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},a.scalar.rotateX=function(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[4],i=t[5],u=t[6],s=t[7],f=t[8],l=t[9],c=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*a+f*r,e[5]=i*a+l*r,e[6]=u*a+c*r,e[7]=s*a+d*r,e[8]=f*a-o*r,e[9]=l*a-i*r,e[10]=c*a-u*r,e[11]=d*a-s*r,e},a.SIMD.rotateX=function(e,t,n){var r=SIMD.Float32x4.splat(Math.sin(n)),a=SIMD.Float32x4.splat(Math.cos(n));t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var o=SIMD.Float32x4.load(t,4),i=SIMD.Float32x4.load(t,8);return SIMD.Float32x4.store(e,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,r))),SIMD.Float32x4.store(e,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,r))),e},a.rotateX=r.USE_SIMD?a.SIMD.rotateX:a.scalar.rotateX,a.scalar.rotateY=function(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],u=t[2],s=t[3],f=t[8],l=t[9],c=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a-f*r,e[1]=i*a-l*r,e[2]=u*a-c*r,e[3]=s*a-d*r,e[8]=o*r+f*a,e[9]=i*r+l*a,e[10]=u*r+c*a,e[11]=s*r+d*a,e},a.SIMD.rotateY=function(e,t,n){var r=SIMD.Float32x4.splat(Math.sin(n)),a=SIMD.Float32x4.splat(Math.cos(n));t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var o=SIMD.Float32x4.load(t,0),i=SIMD.Float32x4.load(t,8);return SIMD.Float32x4.store(e,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,r))),SIMD.Float32x4.store(e,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(i,a))),e},a.rotateY=r.USE_SIMD?a.SIMD.rotateY:a.scalar.rotateY,a.scalar.rotateZ=function(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],u=t[2],s=t[3],f=t[4],l=t[5],c=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a+f*r,e[1]=i*a+l*r,e[2]=u*a+c*r,e[3]=s*a+d*r,e[4]=f*a-o*r,e[5]=l*a-i*r,e[6]=c*a-u*r,e[7]=d*a-s*r,e},a.SIMD.rotateZ=function(e,t,n){var r=SIMD.Float32x4.splat(Math.sin(n)),a=SIMD.Float32x4.splat(Math.cos(n));t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var o=SIMD.Float32x4.load(t,0),i=SIMD.Float32x4.load(t,4);return SIMD.Float32x4.store(e,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,r))),SIMD.Float32x4.store(e,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,r))),e},a.rotateZ=r.USE_SIMD?a.SIMD.rotateZ:a.scalar.rotateZ,a.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},a.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.fromRotation=function(e,t,n){var a,o,i,u=n[0],s=n[1],f=n[2],l=Math.sqrt(u*u+s*s+f*f);return Math.abs(l)<r.EPSILON?null:(l=1/l,u*=l,s*=l,f*=l,a=Math.sin(t),o=Math.cos(t),i=1-o,e[0]=u*u*i+o,e[1]=s*u*i+f*a,e[2]=f*u*i-s*a,e[3]=0,e[4]=u*s*i-f*a,e[5]=s*s*i+o,e[6]=f*s*i+u*a,e[7]=0,e[8]=u*f*i+s*a,e[9]=s*f*i-u*a,e[10]=f*f*i+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},a.fromXRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.fromYRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.fromZRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.fromRotationTranslation=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=r+r,s=a+a,f=o+o,l=r*u,c=r*s,d=r*f,m=a*s,h=a*f,p=o*f,b=i*u,v=i*s,x=i*f;return e[0]=1-(m+p),e[1]=c+x,e[2]=d-v,e[3]=0,e[4]=c-x,e[5]=1-(l+p),e[6]=h+b,e[7]=0,e[8]=d+v,e[9]=h-b,e[10]=1-(l+m),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},a.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},a.getRotation=function(e,t){var n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e},a.fromRotationTranslationScale=function(e,t,n,r){var a=t[0],o=t[1],i=t[2],u=t[3],s=a+a,f=o+o,l=i+i,c=a*s,d=a*f,m=a*l,h=o*f,p=o*l,b=i*l,v=u*s,x=u*f,g=u*l,y=r[0],M=r[1],S=r[2];return e[0]=(1-(h+b))*y,e[1]=(d+g)*y,e[2]=(m-x)*y,e[3]=0,e[4]=(d-g)*M,e[5]=(1-(c+b))*M,e[6]=(p+v)*M,e[7]=0,e[8]=(m+x)*S,e[9]=(p-v)*S,e[10]=(1-(c+h))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},a.fromRotationTranslationScaleOrigin=function(e,t,n,r,a){var o=t[0],i=t[1],u=t[2],s=t[3],f=o+o,l=i+i,c=u+u,d=o*f,m=o*l,h=o*c,p=i*l,b=i*c,v=u*c,x=s*f,g=s*l,y=s*c,M=r[0],S=r[1],w=r[2],D=a[0],I=a[1],F=a[2];return e[0]=(1-(p+v))*M,e[1]=(m+y)*M,e[2]=(h-g)*M,e[3]=0,e[4]=(m-y)*S,e[5]=(1-(d+v))*S,e[6]=(b+x)*S,e[7]=0,e[8]=(h+g)*w,e[9]=(b-x)*w,e[10]=(1-(d+p))*w,e[11]=0,e[12]=n[0]+D-(e[0]*D+e[4]*I+e[8]*F),e[13]=n[1]+I-(e[1]*D+e[5]*I+e[9]*F),e[14]=n[2]+F-(e[2]*D+e[6]*I+e[10]*F),e[15]=1,e},a.fromQuat=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n+n,u=r+r,s=a+a,f=n*i,l=r*i,c=r*u,d=a*i,m=a*u,h=a*s,p=o*i,b=o*u,v=o*s;return e[0]=1-c-h,e[1]=l+v,e[2]=d-b,e[3]=0,e[4]=l-v,e[5]=1-f-h,e[6]=m+p,e[7]=0,e[8]=d+b,e[9]=m-p,e[10]=1-f-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},a.frustum=function(e,t,n,r,a,o,i){var u=1/(n-t),s=1/(a-r),f=1/(o-i);return e[0]=2*o*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*s,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(a+r)*s,e[10]=(i+o)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*o*2*f,e[15]=0,e},a.perspective=function(e,t,n,r,a){var o=1/Math.tan(t/2),i=1/(r-a);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(a+r)*i,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*a*r*i,e[15]=0,e},a.perspectiveFromFieldOfView=function(e,t,n,r){var a=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),s=2/(i+u),f=2/(a+o);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=-(i-u)*s*.5,e[9]=(a-o)*f*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},a.ortho=function(e,t,n,r,a,o,i){var u=1/(t-n),s=1/(r-a),f=1/(o-i);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(a+r)*s,e[14]=(i+o)*f,e[15]=1,e},a.lookAt=function(e,t,n,o){var i,u,s,f,l,c,d,m,h,p,b=t[0],v=t[1],x=t[2],g=o[0],y=o[1],M=o[2],S=n[0],w=n[1],D=n[2];return Math.abs(b-S)<r.EPSILON&&Math.abs(v-w)<r.EPSILON&&Math.abs(x-D)<r.EPSILON?a.identity(e):(d=b-S,m=v-w,h=x-D,p=1/Math.sqrt(d*d+m*m+h*h),d*=p,m*=p,h*=p,i=y*h-M*m,u=M*d-g*h,s=g*m-y*d,p=Math.sqrt(i*i+u*u+s*s),p?(p=1/p,i*=p,u*=p,s*=p):(i=0,u=0,s=0),f=m*s-h*u,l=h*i-d*s,c=d*u-m*i,p=Math.sqrt(f*f+l*l+c*c),p?(p=1/p,f*=p,l*=p,c*=p):(f=0,l=0,c=0),e[0]=i,e[1]=f,e[2]=d,e[3]=0,e[4]=u,e[5]=l,e[6]=m,e[7]=0,e[8]=s,e[9]=c,e[10]=h,e[11]=0,e[12]=-(i*b+u*v+s*x),e[13]=-(f*b+l*v+c*x),e[14]=-(d*b+m*v+h*x),e[15]=1,e)},a.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},a.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e},a.sub=a.subtract,a.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},a.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},a.equals=function(e,t){var n=e[0],a=e[1],o=e[2],i=e[3],u=e[4],s=e[5],f=e[6],l=e[7],c=e[8],d=e[9],m=e[10],h=e[11],p=e[12],b=e[13],v=e[14],x=e[15],g=t[0],y=t[1],M=t[2],S=t[3],w=t[4],D=t[5],I=t[6],F=t[7],A=t[8],_=t[9],E=t[10],k=t[11],T=t[12],z=t[13],O=t[14],P=t[15];return Math.abs(n-g)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(a-y)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(o-M)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(i-S)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(u-w)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(s-D)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(D))&&Math.abs(f-I)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(l-F)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(c-A)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(d-_)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(m-E)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(E))&&Math.abs(h-k)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(p-T)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(b-z)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(z))&&Math.abs(v-O)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(x-P)<=r.EPSILON*Math.max(1,Math.abs(x),Math.abs(P))},e.exports=a},function(e,t,n){var r=n(0),a=n(5),o=n(6),i=n(7),u={};u.create=function(){var e=new r.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},u.rotationTo=function(){var e=o.create(),t=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(r,a,i){var s=o.dot(a,i);return s<-.999999?(o.cross(e,t,a),o.length(e)<1e-6&&o.cross(e,n,a),o.normalize(e,e),u.setAxisAngle(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o.cross(e,a,i),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,u.normalize(r,r))}}(),u.setAxes=function(){var e=a.create();return function(t,n,r,a){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],u.normalize(t,u.fromMat3(t,e))}}(),u.clone=i.clone,u.fromValues=i.fromValues,u.copy=i.copy,u.set=i.set,u.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},u.setAxisAngle=function(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},u.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return 0!=r?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n},u.add=i.add,u.multiply=function(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],u=n[0],s=n[1],f=n[2],l=n[3];return e[0]=r*l+i*u+a*f-o*s,e[1]=a*l+i*s+o*u-r*f,e[2]=o*l+i*f+r*s-a*u,e[3]=i*l-r*u-a*s-o*f,e},u.mul=u.multiply,u.scale=i.scale,u.rotateX=function(e,t,n){n*=.5;var r=t[0],a=t[1],o=t[2],i=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+i*u,e[1]=a*s+o*u,e[2]=o*s-a*u,e[3]=i*s-r*u,e},u.rotateY=function(e,t,n){n*=.5;var r=t[0],a=t[1],o=t[2],i=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s-o*u,e[1]=a*s+i*u,e[2]=o*s+r*u,e[3]=i*s-a*u,e},u.rotateZ=function(e,t,n){n*=.5;var r=t[0],a=t[1],o=t[2],i=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+a*u,e[1]=a*s-r*u,e[2]=o*s+i*u,e[3]=i*s-o*u,e},u.calculateW=function(e,t){var n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e},u.dot=i.dot,u.lerp=i.lerp,u.slerp=function(e,t,n,r){var a,o,i,u,s,f=t[0],l=t[1],c=t[2],d=t[3],m=n[0],h=n[1],p=n[2],b=n[3];return o=f*m+l*h+c*p+d*b,o<0&&(o=-o,m=-m,h=-h,p=-p,b=-b),1-o>1e-6?(a=Math.acos(o),i=Math.sin(a),u=Math.sin((1-r)*a)/i,s=Math.sin(r*a)/i):(u=1-r,s=r),e[0]=u*f+s*m,e[1]=u*l+s*h,e[2]=u*c+s*p,e[3]=u*d+s*b,e},u.sqlerp=function(){var e=u.create(),t=u.create();return function(n,r,a,o,i,s){return u.slerp(e,r,i,s),u.slerp(t,a,o,s),u.slerp(n,e,t,2*s*(1-s)),n}}(),u.invert=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o,u=i?1/i:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-a*u,e[3]=o*u,e},u.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},u.length=i.length,u.len=u.length,u.squaredLength=i.squaredLength,u.sqrLen=u.squaredLength,u.normalize=i.normalize,u.fromMat3=function(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var o=(a+1)%3,i=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*o+o]-t[3*i+i]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*o+i]-t[3*i+o])*n,e[o]=(t[3*o+a]+t[3*a+o])*n,e[i]=(t[3*i+a]+t[3*a+i])*n}return e},u.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},u.exactEquals=i.exactEquals,u.equals=i.equals,e.exports=u},function(e,t,n){var r=n(0),a={};a.create=function(){var e=new r.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},a.clone=function(e){var t=new r.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},a.fromValues=function(e,t){var n=new r.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},a.set=function(e,t,n){return e[0]=t,e[1]=n,e},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},a.div=a.divide,a.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},a.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},a.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},a.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},a.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},a.normalize=function(e,t){var n=t[0],r=t[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},a.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},a.lerp=function(e,t,n,r){var a=t[0],o=t[1];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e},a.random=function(e,t){t=t||1;var n=2*r.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},a.transformMat2=function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a,e[1]=n[1]*r+n[3]*a,e},a.transformMat2d=function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a+n[4],e[1]=n[1]*r+n[3]*a+n[5],e},a.transformMat3=function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[3]*a+n[6],e[1]=n[1]*r+n[4]*a+n[7],e},a.transformMat4=function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[4]*a+n[12],e[1]=n[1]*r+n[5]*a+n[13],e},a.forEach=function(){var e=a.create();return function(t,n,r,a,o,i){var u,s;for(n||(n=2),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],o(e,e,i),t[u]=e[0],t[u+1]=e[1];return t}}(),a.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},a.equals=function(e,t){var n=e[0],a=e[1],o=t[0],i=t[1];return Math.abs(n-o)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-i)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(i))},e.exports=a},function(e,t,n){(function(t){function r(e){return e?f[e]:f}function a(){s.forEach(function(e){f[u[e]]=!1})}function o(e){f[u[e.keyCode]]=!1}function i(e){f[u[e.keyCode]]=!0}var u=n(52),s=Object.keys(u),f={};a(),e.exports=r,t.browser&&(window.addEventListener("keydown",i,!1),window.addEventListener("keyup",o,!1),window.addEventListener("blur",a,!1))}).call(t,n(50))},function(e,t,n){function r(e,t){function n(){this.prevX=this.x,this.prevY=this.y}var r=new a;return r.x=0,r.y=0,r.prevX=0,r.prevY=0,r.flush=n,"undefined"==typeof window?r:(t=t||e||window,e=e||document.body,t.addEventListener("mousemove",e===document.body||e===window?function(e){r.prevX=r.x,r.prevY=r.y,r.x=e.clientX,r.y=e.clientY,r.emit("move",e)}:function(t){r.prevX=r.x,r.prevY=r.y;var n=e.getBoundingClientRect();r.x=t.clientX-n.left,r.y=t.clientY-n.top,r.emit("move",t)},!1),r)}var a=n(2);e.exports=r},function(e,t,n){function r(e,t){function n(e){if(i.right=!1,i[o[e.button]]=!0,i.emit("down",e),t){if(!e.preventDefault)return!1;e.preventDefault(),e.stopPropagation()}}function r(e){i.right=!1,i[o[e.button]]=!1,i.emit("up",e),t&&e.preventDefault&&(e.preventDefault(),e.stopPropagation())}var i=new a;return i.left=!1,i.right=!1,i.middle=!1,"undefined"!=typeof window&&(e=e||window,e.addEventListener("mousedown",n,!1),e.addEventListener("mouseup",r,!1),t&&e.addEventListener("contextmenu",function(e){return e.preventDefault&&e.preventDefault()&&!1},!1)),i}var a=n(2),o=["left","middle","right"];e.exports=r},function(e,t,n){"use strict";function r(e,t,n){this.rotation=e,this.center=t,this.distance=n}function a(e,t){var n=t[0],r=t[1],a=(t[2],n*n+r*r);a>1&&(a=1),e[0]=-t[0],e[1]=t[1],e[2]=t[2]||Math.sqrt(1-a),e[3]=0}function o(e,t,n){e=e||[0,0,-1],t=t||[0,0,0],n=n||[0,1,0];var a=new r(l.create(),u.create(),1);return a.lookAt(e,t,n),a}var i=n(40),u=i.vec3,s=i.mat3,f=i.mat4,l=i.quat,c=new Float32Array(16),d=new Float32Array(16),m=r.prototype;m.view=function(e){return e||(e=f.create()),d[0]=d[1]=0,d[2]=-this.distance,f.fromRotationTranslation(e,l.conjugate(c,this.rotation),d),f.translate(e,e,u.negate(c,this.center)),e},m.lookAt=function(e,t,n){f.lookAt(c,e,t,n),s.fromMat4(c,c),l.fromMat3(this.rotation,c),u.copy(this.center,t),this.distance=u.distance(e,t)},m.pan=function(e){var t=this.distance;c[0]=-t*(e[0]||0),c[1]=t*(e[1]||0),c[2]=t*(e[2]||0),u.transformQuat(c,c,this.rotation),u.add(this.center,this.center,c)},m.zoom=function(e){this.distance+=e,this.distance<0&&(this.distance=0)},m.rotate=function(e,t){a(c,e),a(d,t),l.invert(d,d),l.multiply(c,c,d),l.length(c)<1e-6||(l.multiply(this.rotation,this.rotation,c),l.normalize(this.rotation,this.rotation))},e.exports=o},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(c===clearTimeout)return clearTimeout(e);if((c===r||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}function i(){p&&m&&(p=!1,m.length?h=m.concat(h):b=-1,h.length&&u())}function u(){if(!p){var e=a(i);p=!0;for(var t=h.length;t;){for(m=h,h=[];++b<t;)m&&m[b].run();b=-1,t=h.length}m=null,p=!1,o(e)}}function s(e,t){this.fun=e,this.array=t}function f(){}var l,c,d=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{c="function"==typeof clearTimeout?clearTimeout:r}catch(e){c=r}}();var m,h=[],p=!1,b=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new s(e,t)),1!==h.length||p||a(u)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=f,d.addListener=f,d.once=f,d.off=f,d.removeListener=f,d.removeAllListeners=f,d.emit=f,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,n){function r(e,t){function n(){i[0]=i[1]=i[2]=0}function r(e){var n=1===e.deltaMode?12:1;i[0]+=n*(e.deltaX||0),i[1]+=n*(e.deltaY||0),i[2]+=n*(e.deltaZ||0),i.emit("scroll",i),t&&e.preventDefault&&(e.preventDefault(),e.stopPropagation&&e.stopPropagation())}var i=new a;return i.flush=n,n(),"undefined"==typeof window?i:(e=e||window,o(e,r,!1),i)}var a=n(2),o=n(57);e.exports=r},function(e,t){var n,r="undefined"!=typeof window?window.navigator.userAgent:"",a=/OS X/.test(r),o=/Opera/.test(r),i=!/like Gecko/.test(r)&&!o,u=e.exports={0:a?"<menu>":"<UNK>",1:"<mouse 1>",2:"<mouse 2>",3:"<break>",4:"<mouse 3>",5:"<mouse 4>",6:"<mouse 5>",8:"<backspace>",9:"<tab>",12:"<clear>",13:"<enter>",16:"<shift>",17:"<control>",18:"<alt>",19:"<pause>",20:"<caps-lock>",21:"<ime-hangul>",23:"<ime-junja>",24:"<ime-final>",25:"<ime-kanji>",27:"<escape>",28:"<ime-convert>",29:"<ime-nonconvert>",30:"<ime-accept>",31:"<ime-mode-change>",27:"<escape>",32:"<space>",33:"<page-up>",34:"<page-down>",35:"<end>",36:"<home>",37:"<left>",38:"<up>",39:"<right>",40:"<down>",41:"<select>",42:"<print>",43:"<execute>",44:"<snapshot>",45:"<insert>",46:"<delete>",47:"<help>",91:"<meta>",92:"<meta>",93:a?"<meta>":"<menu>",95:"<sleep>",106:"<num-*>",107:"<num-+>",108:"<num-enter>",109:"<num--\x3e",110:"<num-.>",111:"<num-/>",144:"<num-lock>",145:"<scroll-lock>",160:"<shift-left>",161:"<shift-right>",162:"<control-left>",163:"<control-right>",164:"<alt-left>",165:"<alt-right>",166:"<browser-back>",167:"<browser-forward>",168:"<browser-refresh>",169:"<browser-stop>",170:"<browser-search>",171:"<browser-favorites>",172:"<browser-home>",173:a&&i?"-":"<volume-mute>",174:"<volume-down>",175:"<volume-up>",176:"<next-track>",177:"<prev-track>",178:"<stop>",179:"<play-pause>",180:"<launch-mail>",181:"<launch-media-select>",182:"<launch-app 1>",183:"<launch-app 2>",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"<meta>",224:"<meta>",226:"<alt-gr>",229:"<ime-process>",231:o?"`":"<unicode>",246:"<attention>",247:"<crsel>",248:"<exsel>",249:"<erase-eof>",250:"<play>",251:"<zoom>",252:"<no-name>",253:"<pa-1>",254:"<clear>"};for(n=58;n<65;++n)u[n]=String.fromCharCode(n);for(n=48;n<58;++n)u[n]=n-48+"";for(n=65;n<91;++n)u[n]=String.fromCharCode(n);for(n=96;n<106;++n)u[n]="<num-"+(n-96)+">";for(n=112;n<136;++n)u[n]="F"+(n-111)},function(e,t){e.exports="precision mediump float;\n\nvarying vec3 worldSpaceCoords;\n\nvoid main() {\n  gl_FragColor = vec4(worldSpaceCoords.xyz, 1);\n}\n"},function(e,t){e.exports="precision mediump float;\n\nuniform mat4 proj;\nuniform mat4 model;\nuniform mat4 view;\n\nattribute vec3 position;\n\nvarying vec3 worldSpaceCoords;\n\nvoid main()\n{\n  worldSpaceCoords = position + vec3(0.5, 0.5, 0.5);\n  gl_Position = proj * view * model * vec4(position, 1.0);\n}\n"},function(e,t){e.exports="precision mediump float;\n\nvarying vec3 worldSpaceCoords;\nvarying vec4 projectedCoords;\n\nuniform sampler2D tex;\nuniform sampler2D cubeTex;\nuniform sampler2D transferTex;\nuniform float steps;\nuniform float alphaCorrection;\n\n// The maximum distance through our rendering volume is sqrt(3).\n// The maximum number of steps we take to travel a distance of 1 is 512.\n// ceil( sqrt(3) * 512 ) = 887\n// This prevents the back of the image from getting cut off when steps=512 &\n// viewing diagonally.\nconst int MAX_STEPS = 887;\n\n// Acts like a texture3D using Z slices and trilinear filtering.\nvec4 sampleAs3DTexture(vec3 texCoord) {\n  vec4 colorSlice1;\n  vec4 colorSlice2;\n  vec2 texCoordSlice1;\n  vec2 texCoordSlice2;\n\n  // The z coordinate determines which Z slice we have to look for.\n  // Z slice number goes from 0 to 255.\n  float zSliceNumber1 = floor(texCoord.z * 255.0);\n\n  // As we use trilinear we go the next Z slice.\n  float zSliceNumber2 = min(zSliceNumber1 + 1.0, 255.0); // Clamp to 255\n\n  // The Z slices are stored in a matrix of 16x16 of Z slices.\n  // The original UV coordinates have to be rescaled by the tile numbers in each\n  // row and column.\n  texCoord.xy /= 16.0;\n\n  texCoordSlice1 = texCoordSlice2 = texCoord.xy;\n\n  // Add an offset to the original UV coordinates depending on the row and\n  // column number.\n  texCoordSlice1.x += (mod(zSliceNumber1, 16.0) / 16.0);\n  texCoordSlice1.y += floor((255.0 - zSliceNumber1) / 16.0) / 16.0;\n\n  texCoordSlice2.x += (mod(zSliceNumber2, 16.0) / 16.0);\n  texCoordSlice2.y += floor((255.0 - zSliceNumber2) / 16.0) / 16.0;\n\n  // Get the opacity value from the 2D texture.\n  // Bilinear filtering is done at each texture2D by default.\n  colorSlice1 = texture2D(cubeTex, texCoordSlice1);\n  colorSlice2 = texture2D(cubeTex, texCoordSlice2);\n\n  // TODO: only interpolate the sampled alpha values, then do the transfer lookup\n\n  // Based on the opacity obtained earlier, get the RGB color in the transfer\n  // function texture.\n  colorSlice1.rgb = texture2D(transferTex, vec2(colorSlice1.a, 1.0)).rgb;\n  colorSlice2.rgb = texture2D(transferTex, vec2(colorSlice2.a, 1.0)).rgb;\n\n  // How distant is zSlice1 to ZSlice2. Used to interpolate between one Z slice\n  // and the other.\n  float zDifference = mod(texCoord.z * 255.0, 1.0);\n\n  // Finally interpolate between the two intermediate colors of each Z slice.\n  return mix(colorSlice1, colorSlice2, zDifference);\n}\n\nvoid main(void) {\n  // Transform the coordinates it from [-1;1] to [0;1]\n  vec2 texc = vec2(((projectedCoords.x / projectedCoords.w) + 1.0) / 2.0,\n                   ((projectedCoords.y / projectedCoords.w) + 1.0) / 2.0);\n\n  // The back position is the world space position stored in the texture.\n  vec3 backPos = texture2D(tex, texc).xyz;\n\n  // The front position is the world space position of the second render pass.\n  vec3 frontPos = worldSpaceCoords;\n\n  // The direction from the front position to back position.\n  vec3 dir = backPos - frontPos;\n\n  float rayLength = length(dir);\n\n  // Calculate how long to increment in each step.\n  float delta = 1.0 / steps;\n\n  // The increment in each direction for each step.\n  vec3 deltaDirection = normalize(dir) * delta;\n  float deltaDirectionLength = length(deltaDirection);\n\n  // Start the ray casting from the front position.\n  vec3 currentPosition = frontPos;\n\n  // The color accumulator.\n  vec4 accumulatedColor = vec4(0.0);\n\n  // The alpha value accumulated so far.\n  float accumulatedAlpha = 0.0;\n\n  // How long has the ray travelled so far.\n  float accumulatedLength = 0.0;\n\n  // If we have twice as many samples, we only need ~1/2 the alpha per sample.\n  // Scaling by 256/10 just happens to give a good value for the alphaCorrection\n  // slider.\n  float alphaScaleFactor = 25.6 * delta;\n\n  vec4 colorSample;\n  float alphaSample;\n\n  // Perform the ray marching iterations\n  for (int i = 0; i < MAX_STEPS; i++) {\n    // Get the voxel intensity value from the 3D texture.\n    colorSample = sampleAs3DTexture(currentPosition);\n\n    // Allow the alpha correction customization.\n    alphaSample = colorSample.a * alphaCorrection;\n\n    // Applying this effect to both the color and alpha accumulation results in\n    // more realistic transparency.\n    alphaSample *= (1.0 - accumulatedAlpha);\n\n    // Scaling alpha by the number of steps makes the final color invariant to\n    // the step size.\n    alphaSample *= alphaScaleFactor;\n\n    // Perform the composition.\n    accumulatedColor += colorSample * alphaSample;\n\n    // Store the alpha accumulated so far.\n    accumulatedAlpha += alphaSample;\n\n    // Advance the ray.\n    currentPosition += deltaDirection;\n    accumulatedLength += deltaDirectionLength;\n\n    // If the length traversed is more than the ray length, or if the alpha\n    // accumulated reaches 1.0 then exit.\n    if (accumulatedLength >= rayLength || accumulatedAlpha >= 1.0)\n      break;\n  }\n\n  gl_FragColor = accumulatedColor;\n}\n"},function(e,t){e.exports="precision mediump float;\n\nuniform mat4 proj;\nuniform mat4 model;\nuniform mat4 view;\n\nattribute vec3 position;\n\nvarying vec3 worldSpaceCoords;\nvarying vec4 projectedCoords;\n\nvoid main() {\n  worldSpaceCoords = (model * vec4(position + vec3(0.5, 0.5, 0.5), 1.0)).xyz;\n  gl_Position = proj * view * model * vec4(position, 1.0);\n  projectedCoords = proj * view * model * vec4(position, 1.0);\n}\n"},function(e,t){function n(e,t,n){r(e,o,t,n),"DOMMouseScroll"==o&&r(e,"MozMousePixelScroll",t,n)}function r(e,t,n,r){e[a](i+t,"wheel"==o?n:function(e){!e&&(e=window.event);var t={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}};return"mousewheel"==o?(t.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(t.deltaX=-.025*e.wheelDeltaX)):t.deltaY=e.detail,n(t)},r||!1)}e.exports=n;var a,o,i="";window.addEventListener?a="addEventListener":(a="attachEvent",i="on"),o="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"}]);
//# sourceMappingURL=bundle.js.map